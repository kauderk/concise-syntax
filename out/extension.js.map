{"version":3,"file":"extension.js","sources":["../src/shared/messages.ts","../src/shared/write.ts","../src/extension/utils.ts","../src/extension/settings.ts","../src/extension/statusBarItem.ts","../src/extension/extensionCycle.ts","../src/extension/index.ts"],"sourcesContent":["export default {\r\n  admin: 'Run VS Code with admin privileges so the changes can be applied.',\r\n  enabled: 'Concise syntax enabled. Restart to take effect. ',\r\n  disabled:\r\n    'Concise syntax disabled and reverted to default. Restart to take effect.',\r\n  already_disabled: 'Concise syntax already disabled.',\r\n  somethingWrong: 'Something went wrong: ',\r\n  internalError: 'Internal error: ',\r\n  restartIde: 'Restart Visual Studio Code',\r\n  notfound: 'Concise syntax not found.',\r\n  notConfigured: 'Concise syntax path not configured.',\r\n  reloadAfterVersionUpgrade:\r\n    'Detected reloading Concise syntax after VSCode is upgraded. ' +\r\n    'Performing application only.',\r\n  cannotLoad: (url: string) => `Cannot load '${url}'. Skipping.` as const,\r\n} as const\r\n","import fs from 'fs'\r\nimport path from 'path'\r\nimport packageJson from '../../package.json'\r\n\r\nexport const extensionId = packageJson.publisher + '.' + packageJson.name\r\nexport const extensionScriptSrc = extensionId + '.js'\r\nexport const extensionScriptTag = () =>\r\n  new RegExp(\r\n    `<script.+${extensionId.replaceAll('.', '\\\\.')}.+\\/script>`,\r\n    'gm' // intermittently\r\n  )\r\n\r\nexport async function patchWorkbench(\r\n  res: Awaited<ReturnType<typeof preRead>>,\r\n  remoteWorkbenchPath: string\r\n) {\r\n  await fs.promises.copyFile(remoteWorkbenchPath, res.workbench.customPath)\r\n\r\n  const hash = ('' + Math.random()).substring(2, 7)\r\n  const newHtml = res.html\r\n    .replaceAll(extensionScriptTag(), '')\r\n    .replace(\r\n      /(<\\/html>)/,\r\n      `<script src=\"${extensionScriptSrc}?${hash}\"></script>` + '</html>'\r\n    )\r\n\r\n  await fs.promises.writeFile(res.workbench.path, newHtml, 'utf-8')\r\n}\r\nexport async function preRead(base: string) {\r\n  const workbenchPath = path.join(base, 'workbench.html')\r\n  const html = await fs.promises.readFile(workbenchPath, 'utf-8')\r\n  const wasActive = html.match(extensionScriptTag())\r\n  return {\r\n    html,\r\n    wasActive,\r\n    workbench: {\r\n      path: workbenchPath,\r\n      customPath: path.join(base, extensionScriptSrc),\r\n    },\r\n  }\r\n}\r\n","// FIXME: handle the errors where it is being used\r\nexport function _catch(e: unknown) {}\r\n","import * as vscode from 'vscode'\r\nimport * as fs from 'fs'\r\nimport * as path from 'path'\r\nimport { _catch } from './utils'\r\nimport JSONC from 'comment-json'\r\n\r\nconst key = 'editor.tokenColorCustomizations'\r\nconst textMateRules = [\r\n  {\r\n    name: 'kauderk.concise-syntax.text',\r\n    scope: ['meta.jsx.children.tsx'],\r\n    settings: {\r\n      foreground: '#B59E7A',\r\n    },\r\n  },\r\n  {\r\n    name: 'kauderk.concise-syntax.redundant',\r\n    scope: [\r\n      'punctuation.definition.tag.begin.tsx',\r\n      'punctuation.definition.tag.end.tsx',\r\n      'punctuation.section.embedded.begin.tsx',\r\n      'punctuation.section.embedded.end.tsx',\r\n      'punctuation.terminator.statement.tsx',\r\n      'concise.redundant-syntax',\r\n    ],\r\n    settings: {\r\n      foreground: '#00b51b00',\r\n    },\r\n  },\r\n  {\r\n    name: 'kauderk.concise-syntax.quote.begin',\r\n    scope: ['punctuation.definition.string.begin.tsx'],\r\n    settings: {\r\n      foreground: '#b5a90000',\r\n    },\r\n  },\r\n  {\r\n    name: 'kauderk.concise-syntax.quote.end',\r\n    scope: ['punctuation.definition.string.end.tsx'],\r\n    settings: {\r\n      foreground: '#b5030000',\r\n    },\r\n  },\r\n]\r\nconst settingsJsonPath = '.vscode/settings.json'\r\nconst remoteSettingsJsonPath = 'remote.settings.jsonc'\r\n\r\n// TODO: avoid writing defensive code, someone else surely knows a better way to do this\r\nexport async function updateSettingsCycle(operation: 'inactive' | 'active') {\r\n  const res = await tryParseSettings()\r\n  if (!res) return\r\n  const { wasEmpty, userRules } = res\r\n\r\n  if (operation == 'active') {\r\n    if (wasEmpty) {\r\n      userRules.push(...textMateRules)\r\n    } else {\r\n      // add what is missing\r\n      for (const rule of textMateRules) {\r\n        const exist = userRules.some((r, i) =>\r\n          r?.name === rule.name ? (userRules![i] = rule) : false\r\n        )\r\n        if (!exist) {\r\n          userRules.push(rule)\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    if (wasEmpty) {\r\n      return\r\n    } else {\r\n      for (let i = userRules.length - 1; i >= 0; i--) {\r\n        const rule = userRules[i]\r\n        if (rule && textMateRules.find((r) => r.name == rule.name)) {\r\n          userRules.splice(i, 1)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  await res.write()\r\n}\r\n\r\nasync function tryParseSettings() {\r\n  const workspace = vscode.workspace.workspaceFolders?.[0].uri\r\n  if (!workspace) {\r\n    vscode.window.showErrorMessage(\r\n      'No workspace found: cannot update textMateRules'\r\n    )\r\n    return\r\n  }\r\n\r\n  const userSettingsPath = workspace.fsPath + '/' + settingsJsonPath\r\n\r\n  let raw_json: string | undefined\r\n  let config: any\r\n  try {\r\n    raw_json = await fs.promises.readFile(userSettingsPath, 'utf-8')\r\n    config = JSONC.parse(raw_json)\r\n  } catch (error) {\r\n    config ??= {}\r\n    console.error(error)\r\n  }\r\n\r\n  if (raw_json === undefined) {\r\n    vscode.window.showErrorMessage(\r\n      `Cannot read ${settingsJsonPath}: does not exist or is not valid JSON`\r\n    )\r\n    return\r\n  }\r\n\r\n  // NOTE: This is a special object https://www.npmjs.com/package/comment-json#commentarray\r\n  let userRules: DeepPartial<typeof textMateRules> | undefined =\r\n    config?.[key]?.textMateRules\r\n\r\n  if (userRules && !Array.isArray(userRules)) {\r\n    vscode.window.showErrorMessage(\r\n      `${settingsJsonPath}: ${key}.textMateRules is not an array`\r\n    )\r\n    return\r\n  }\r\n\r\n  const wasEmpty = !userRules || userRules?.length == 0\r\n  if (!userRules) {\r\n    userRules = []\r\n    config[key] = { textMateRules: userRules }\r\n  }\r\n  return {\r\n    userRules,\r\n    wasEmpty,\r\n    async write() {\r\n      try {\r\n        if (raw_json === undefined) throw new Error('raw_json is undefined')\r\n        const indent = raw_json.match(/^\\s+/)?.[0] ?? '  '\r\n        const virtualJson = JSONC.stringify(config, null, indent)\r\n        if (virtualJson === raw_json) return\r\n        await fs.promises.writeFile(userSettingsPath, virtualJson, 'utf-8')\r\n      } catch (error: any) {\r\n        vscode.window.showErrorMessage(\r\n          'Failed to write textMateRules. Error: ' + error.message\r\n        )\r\n      }\r\n    },\r\n  }\r\n}\r\n\r\ntype DeepPartial<T> = T extends object\r\n  ? {\r\n      [P in keyof T]?: DeepPartial<T[P]>\r\n    }\r\n  : T\r\n","import { extensionId } from 'src/shared/write'\r\nimport * as vscode from 'vscode'\r\nimport packageJson from '../../package.json'\r\nimport { updateSettingsCycle } from './settings'\r\n\r\nlet _item: vscode.StatusBarItem\r\n/**\r\n * The icon's purpose is to indicate the workbench.ts script the extension is active.\r\n */\r\nexport async function ExtensionState_statusBarItem(\r\n  context: vscode.ExtensionContext,\r\n  wasActive?: boolean\r\n) {\r\n  // TODO: decouple the update from the status bar item\r\n\r\n  const active = stateManager<'true' | 'false'>(\r\n    context,\r\n    extensionId + '.active'\r\n  )\r\n  if (wasActive !== undefined) {\r\n    await active.write(wasActive ? 'true' : 'false')\r\n  }\r\n\r\n  const emitExtensionState = async (previous: boolean) => {\r\n    // TODO: add a subscriber or something to update the settings before the tooltip\r\n    await updateSettingsCycle(previous ? 'active' : 'inactive')\r\n    _item.tooltip = `Concise Syntax: ` + (previous ? 'active' : 'inactive')\r\n  }\r\n\r\n  if (_item) {\r\n    if (wasActive !== undefined) {\r\n      await emitExtensionState(wasActive)\r\n    }\r\n    return\r\n  }\r\n\r\n  async function toggle(next: boolean) {\r\n    await emitExtensionState(next)\r\n    await active.write(next ? 'true' : 'false')\r\n  }\r\n  const getActive = () => !!JSON.parse(active.read() ?? 'false')\r\n\r\n  const myCommandId = packageJson.contributes.commands[2].command\r\n  context.subscriptions.push(\r\n    vscode.commands.registerCommand(myCommandId, async () => {\r\n      await toggle(!getActive())\r\n    })\r\n  )\r\n  const item = vscode.window.createStatusBarItem(\r\n    vscode.StatusBarAlignment.Right,\r\n    100\r\n  )\r\n  _item = item\r\n  item.command = myCommandId\r\n  item.text = `$(symbol-keyword) Concise`\r\n  await emitExtensionState(getActive())\r\n  item.show()\r\n  context.subscriptions.push(item)\r\n}\r\n\r\nexport function getStateStore(context: vscode.ExtensionContext) {\r\n  return stateManager<'active' | 'restart' | 'disposed'>(\r\n    context,\r\n    extensionId + '.state'\r\n  )\r\n}\r\nexport function getErrorStore(context: vscode.ExtensionContext) {\r\n  return stateManager<'error' | 'throw' | 'unhandled'>(\r\n    context,\r\n    extensionId + '.error'\r\n  )\r\n}\r\nfunction stateManager<T extends string>(\r\n  context: vscode.ExtensionContext,\r\n  key: string\r\n) {\r\n  return {\r\n    value: '' as any,\r\n    read() {\r\n      return (this.value = context.globalState.get(key) as T | undefined)\r\n    },\r\n    async write(newState: T) {\r\n      this.value = newState\r\n      await context.globalState.update(key, newState)\r\n      return newState\r\n    },\r\n  }\r\n}\r\n","import path from 'path'\r\nimport {\r\n  extensionId,\r\n  patchWorkbench,\r\n  extensionScriptTag,\r\n  preRead,\r\n} from 'src/shared/write'\r\nimport { getStateStore, ExtensionState_statusBarItem } from './statusBarItem'\r\nimport { _catch } from './utils'\r\nimport * as vscode from 'vscode'\r\nimport * as fs from 'fs'\r\nimport msg from '../shared/messages'\r\n\r\nexport async function installCycle(context: vscode.ExtensionContext) {\r\n  const state = getStateStore(context)\r\n\r\n  const res = await read()\r\n  if (res.wasActive) {\r\n    console.log('vscode-concise-syntax is active!')\r\n    await ExtensionState_statusBarItem(context, true)\r\n    await state.write('active')\r\n    return true\r\n  }\r\n\r\n  let remoteWorkbenchPath\r\n  let ext = vscode.extensions.getExtension(extensionId)\r\n  if (ext && ext.extensionPath) {\r\n    remoteWorkbenchPath = path.resolve(ext.extensionPath, 'out/workbench.js')\r\n  } else {\r\n    remoteWorkbenchPath = path.resolve(__dirname, 'index.js')\r\n  }\r\n  await patchWorkbench(res, remoteWorkbenchPath)\r\n\r\n  await state.write('restart')\r\n}\r\n\r\nexport async function uninstallCycle(context: vscode.ExtensionContext) {\r\n  const state = getStateStore(context)\r\n\r\n  const { html, wasActive, workbench } = await read()\r\n  if (wasActive) {\r\n    const newHtml = html.replaceAll(extensionScriptTag(), '')\r\n    await fs.promises.writeFile(workbench.path, newHtml, 'utf-8')\r\n  }\r\n  await fs.promises.unlink(workbench.customPath).catch(_catch)\r\n  await state.write('restart')\r\n\r\n  return wasActive\r\n}\r\n// how do you make javascript freak out about promises/errors?\r\nexport function deactivateCycle() {\r\n  // FIXME: why is this hook not working? :(\r\n  console.log('vscode-concise-syntax is deactivated!')\r\n}\r\nexport async function read() {\r\n  if (!require.main?.filename) {\r\n    vscode.window.showErrorMessage(msg.internalError + 'no main filename')\r\n    throw new Error('no main filename')\r\n  }\r\n  const appDir = path.dirname(require.main.filename)\r\n  const base = path.join(appDir, 'vs', 'code', 'electron-sandbox', 'workbench')\r\n  return await preRead(base)\r\n}\r\n","import * as vscode from 'vscode'\r\nimport msg from '../shared/messages'\r\nimport packageJson from '../../package.json'\r\nimport { extensionId } from '../shared/write'\r\nimport { _catch } from './utils'\r\nimport {\r\n  getErrorStore,\r\n  getStateStore,\r\n  ExtensionState_statusBarItem,\r\n} from './statusBarItem'\r\nimport { installCycle, read, uninstallCycle } from './extensionCycle'\r\nexport { deactivateCycle as deactivate } from './extensionCycle'\r\n\r\nexport async function activate(context: vscode.ExtensionContext) {\r\n  const state = getStateStore(context)\r\n\r\n  // FIXME: use a better state manager or state machine\r\n  const { wasActive } = await read()\r\n\r\n  const reloadCommand = packageJson.contributes.commands[0].command\r\n  context.subscriptions.push(\r\n    vscode.commands.registerCommand(reloadCommand, async () => {\r\n      try {\r\n        if (state.read() == 'active') {\r\n          vscode.window.showInformationMessage('Already Mounted')\r\n        } else {\r\n          await uninstallCycle(context)\r\n          await installCycle(context)\r\n          if (!wasActive) {\r\n            reloadWindowMessage(msg.enabled)\r\n          } else {\r\n            await ExtensionState_statusBarItem(context, true)\r\n            vscode.window.showInformationMessage('Mount: using cache')\r\n          }\r\n        }\r\n      } catch (error) {\r\n        __catch(error)\r\n      }\r\n    })\r\n  )\r\n  const disposeCommand = packageJson.contributes.commands[1].command\r\n  context.subscriptions.push(\r\n    vscode.commands.registerCommand(disposeCommand, async () => {\r\n      try {\r\n        const wasActive = await uninstallCycle(context)\r\n        await ExtensionState_statusBarItem(context, false)\r\n\r\n        const [message, ...options] = wasActive\r\n          ? ['Disposed', 'Reload', 'Uninstall']\r\n          : ['Already Disposed', 'Uninstall']\r\n        // prettier-ignore\r\n        const selection = await vscode.window.showInformationMessage(message, ...options)\r\n\r\n        if (selection == 'Reload') {\r\n          vscode.commands.executeCommand('workbench.action.reloadWindow')\r\n        } else if (selection == 'Uninstall') {\r\n          vscode.commands.executeCommand(\r\n            'workbench.extensions.action.uninstallExtension',\r\n            extensionId\r\n          )\r\n        }\r\n      } catch (error) {\r\n        __catch(error)\r\n      } finally {\r\n        await state.write('disposed')\r\n      }\r\n    })\r\n  )\r\n\r\n  if (state.read() != 'disposed') {\r\n    installCycle(context)\r\n      .then(() => {\r\n        if (!wasActive) {\r\n          reloadWindowMessage(msg.enabled)\r\n        }\r\n      })\r\n      .catch(__catch)\r\n  } else if (wasActive) {\r\n    await ExtensionState_statusBarItem(context) // FIXME: this is not persistent\r\n  }\r\n\r\n  console.log('vscode-concise-syntax is active')\r\n\r\n  function __catch(e: unknown) {\r\n    console.error(e)\r\n    const error = getErrorStore(context)\r\n    error.write('unhandled').catch(_catch)\r\n  }\r\n}\r\n\r\nfunction reloadWindowMessage(message: string) {\r\n  vscode.window\r\n    .showInformationMessage(message, { title: msg.restartIde })\r\n    .then((selection) => {\r\n      if (selection) {\r\n        vscode.commands.executeCommand('workbench.action.reloadWindow')\r\n      }\r\n    })\r\n}\r\n"],"names":["vscode","fs","key","wasActive"],"mappings":"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"}