{"version":3,"file":"workbench.js","sources":["../src/workbench/keys.ts","../src/shared/utils.ts","../src/shared/toast.js","../src/workbench/shared.ts","../src/workbench/lifecycle.ts","../src/workbench/syntax.ts","../src/workbench/utils.ts","../src/workbench/highlight.ts","../src/shared/state.ts","../src/shared/clone.ts","../src/workbench/regexToDomToCss.ts","../src/shared/observable.ts","../src/workbench/index.ts"],"sourcesContent":["export const extensionId = 'kauderk.concise-syntax'\r\nexport const extensionScriptSrc = extensionId + '.js'\r\nexport const windowId = 'window.' + extensionId\r\n// exploit the fact that vscode renders data to the dom, could be any other attribute\r\nexport const bridgeBetweenVscodeExtension = 'aria-label'\r\n\r\nexport const editorSelector = '.editor-instance'\r\nexport const idSelector = '[data-mode-id=\"typescriptreact\"]'\r\nexport const viewLinesSelector = '.view-lines.monaco-mouse-cursor-text'\r\nexport const linesSelector = idSelector + ` ` + viewLinesSelector\r\nexport const overlaySelector = '.view-overlays'\r\nexport const highlightSelector = idSelector + ` ` + overlaySelector\r\nexport const selectedSelector = '.selected-text'\r\nexport const currentSelector = '.current-line'\r\nexport const languages = ['typescriptreact', 'javascriptreact']\r\nexport const splitViewContainerSelector = '.split-view-container'\r\n","export function deltaFn<F extends () => any>(consume: boolean = false) {\r\n  let delta: F | undefined\r\n  return {\r\n    consume() {\r\n      delta?.()\r\n      delta = undefined\r\n    },\r\n    get fn() {\r\n      return delta\r\n    },\r\n    set fn(value) {\r\n      // TODO: check if this won't break anything else\r\n      if (consume) this.consume()\r\n      delta = value\r\n    },\r\n  }\r\n}\r\nexport function deltaValue<T>(consume: (value: T) => void) {\r\n  let delta: T | undefined\r\n  return {\r\n    consume() {\r\n      if (delta) consume(delta)\r\n      delta = undefined\r\n    },\r\n    get value() {\r\n      return delta\r\n    },\r\n    set value(value) {\r\n      this.consume()\r\n      delta = value\r\n    },\r\n  }\r\n}\r\n\r\nexport type Task<R = unknown, E = R> = ReturnType<typeof createTask<R, E>>\r\nexport function createTask<R = unknown, E = R>() {\r\n  let resolve = (value?: R) => {},\r\n    reject = (value?: E) => {}\r\n  const promise = new Promise<R | E>((_resolve, _reject) => {\r\n    reject = _reject\r\n    // @ts-expect-error\r\n    resolve = _resolve\r\n  })\r\n  return { promise, resolve, reject }\r\n}\r\n","/*!\r\n* Toastify js 1.12.0\r\n* https://github.com/apvarun/toastify-js\r\n* @license MIT licensed\r\n*\r\n* Copyright (C) 2018 Varun A P\r\n*/\r\n\r\n/**\r\n * Options used for Toastify\r\n * @typedef {Object} ToastifyConfigurationObject\r\n * @property {string} text - Message to be displayed in the toast\r\n * @property {Element} node - Provide a node to be mounted inside the toast. node takes higher precedence over text\r\n * @property {number} duration - Duration for which the toast should be displayed. -1 for permanent toast\r\n * @property {string|Element} selector - CSS ID Selector on which the toast should be added\r\n * @property {url} destination - URL to which the browser should be navigated on click of the toast\r\n * @property {boolean} newWindow - Decides whether the destination should be opened in a new window or not\r\n * @property {boolean} close - To show the close icon or not\r\n * @property {string} gravity - To show the toast from top or bottom\r\n * @property {string} position - To show the toast on left or right\r\n * @property {string} backgroundColor - Deprecated: Sets the background color of the toast\r\n * @property {url} avatar - Image/icon to be shown before text\r\n * @property {string} className - Ability to provide custom class name for further customization\r\n * @property {boolean} stopOnFocus - To stop timer when hovered over the toast (Only if duration is set)\r\n * @property {(toastElement:HTMLElement)=>void} callback - Invoked when the toast is dismissed\r\n * @property {(e:MouseEvent)=>void} onClick - Invoked when the toast is clicked\r\n * @property {Object} offset - Ability to add some offset to axis\r\n * @property {boolean} escapeMarkup - Toggle the default behavior of escaping HTML markup\r\n * @property {string} ariaLive - Use the HTML DOM style property to add styles to toast\r\n * @property {Object} style - Use the HTML DOM style property to add styles to toast\r\n */\r\n\r\n\r\nexport class Toastify {\r\n\r\n\tdefaults = {\r\n\t\toldestFirst: true,\r\n\t\ttext: \"Toastify is awesome!\",\r\n\t\tnode: undefined,\r\n\t\tduration: 3000,\r\n\t\tselector: undefined,\r\n\t\tcallback: function() {},\r\n\t\tdestination: undefined,\r\n\t\tnewWindow: false,\r\n\t\tclose: false,\r\n\t\tgravity: \"toastify-top\",\r\n\t\tpositionLeft: false,\r\n\t\tposition: \"\",\r\n\t\tbackgroundColor: \"\",\r\n\t\tavatar: \"\",\r\n\t\tclassName: \"\",\r\n\t\tstopOnFocus: true,\r\n\t\tonClick: function() {},\r\n\t\toffset: { x: 0, y: 0 },\r\n\t\tescapeMarkup: true,\r\n\t\tariaLive: \"polite\",\r\n\t\tstyle: { background: \"\" },\r\n\t};\r\n\r\n\t/**\r\n\t * Create a new Toastify instance\r\n\t * @param {Partial<ToastifyConfigurationObject>} options - The configuration object to configure Toastify\r\n\t * \r\n\t*/ \r\n\tconstructor(options) {\r\n\t\t/**\r\n\t\t * The version of Toastify\r\n\t\t * @type {string}\r\n\t\t * @public\r\n\t\t */\r\n\t\tthis.version = \"1.12.0\";\r\n\r\n\t\t/**\r\n\t\t * The configuration object to configure Toastify\r\n\t\t * @type {ToastifyConfigurationObject}\r\n\t\t * @public\r\n\t\t */\r\n\t\tthis.options = {};\r\n\r\n\t\t/**\r\n\t\t * The element that is the Toast\r\n\t\t * @type {Element}\r\n\t\t * @public\r\n\t\t */\r\n\t\tthis.toastElement = null;\r\n\r\n\t\t/**\r\n\t\t * The root element that contains all the toasts\r\n\t\t * @type {Element}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._rootElement = document.body;\r\n\r\n\t\tthis._init(options);\r\n\t}\r\n\r\n\t/**\r\n\t * Display the toast\r\n\t * @public\r\n\t */\r\n\tshowToast() {\r\n\t\t// Creating the DOM object for the toast\r\n\t\tthis.toastElement = this._buildToast();\r\n\r\n\t\t// Getting the root element to with the toast needs to be added\r\n\t\tif (typeof this.options.selector === \"string\") {\r\n\t\t\tthis._rootElement = document.getElementById(this.options.selector);\r\n\t\t} else if (this.options.selector instanceof HTMLElement || this.options.selector instanceof ShadowRoot) {\r\n\t\t\tthis._rootElement = this.options.selector;\r\n\t\t} else {\r\n\t\t\tthis._rootElement = document.body;\r\n\t\t}\r\n\r\n\t\t// Validating if root element is present in DOM\r\n\t\tif (!this._rootElement) {\r\n\t\t\tthrow \"Root element is not defined\";\r\n\t\t}\r\n\r\n\t\t// Adding the DOM element\r\n\t\tthis._rootElement.insertBefore(this.toastElement, this._rootElement.firstChild);\r\n\r\n\t\t// Repositioning the toasts in case multiple toasts are present\r\n\t\tthis._reposition();\r\n\r\n\t\tif (this.options.duration > 0) {\r\n\t\t\tthis.toastElement.timeOutValue = window.setTimeout(\r\n\t\t\t\t() => {\r\n\t\t\t\t\t// Remove the toast from DOM\r\n\t\t\t\t\tthis._removeElement(this.toastElement);\r\n\t\t\t\t},\r\n\t\t\t\tthis.options.duration\r\n\t\t\t); // Binding `this` for function invocation\r\n\t\t}\r\n\r\n\t\t// Supporting function chaining\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Hide the toast\r\n\t * @public\r\n\t */\r\n\thideToast() {\r\n\t\tif (this.toastElement.timeOutValue) {\r\n\t\t\tclearTimeout(this.toastElement.timeOutValue);\r\n\t\t}\r\n\t\tthis._removeElement(this.toastElement);\r\n\t}\r\n\r\n\t/**\r\n\t * Init the Toastify class\r\n\t * @param {ToastifyConfigurationObject} options - The configuration object to configure Toastify\r\n\t * @param {string} [options.text=Hi there!] - Message to be displayed in the toast\r\n\t * @param {Element} [options.node] - Provide a node to be mounted inside the toast. node takes higher precedence over text\r\n\t * @param {number} [options.duration=3000] - Duration for which the toast should be displayed. -1 for permanent toast\r\n\t * @param {string} [options.selector] - CSS Selector on which the toast should be added\r\n\t * @param {url} [options.destination] - URL to which the browser should be navigated on click of the toast\r\n\t * @param {boolean} [options.newWindow=false] - Decides whether the destination should be opened in a new window or not\r\n\t * @param {boolean} [options.close=false] - To show the close icon or not\r\n\t * @param {string} [options.gravity=toastify-top] - To show the toast from top or bottom\r\n\t * @param {string} [options.position=right] - To show the toast on left or right\r\n\t * @param {string} [options.backgroundColor] - Sets the background color of the toast (To be deprecated)\r\n\t * @param {url} [options.avatar] - Image/icon to be shown before text\r\n\t * @param {string} [options.className] - Ability to provide custom class name for further customization\r\n\t * @param {boolean} [options.stopOnFocus] - To stop timer when hovered over the toast (Only if duration is set)\r\n\t * @param {Function} [options.callback] - Invoked when the toast is dismissed\r\n\t * @param {Function} [options.onClick] - Invoked when the toast is clicked\r\n\t * @param {Object} [options.offset] - Ability to add some offset to axis\r\n\t * @param {boolean} [options.escapeMarkup=true] - Toggle the default behavior of escaping HTML markup\r\n\t * @param {string} [options.ariaLive] - Announce the toast to screen readers\r\n\t * @param {Object} [options.style] - Use the HTML DOM style property to add styles to toast\r\n\t * @private\r\n\t */\r\n\t_init(options) {\r\n\r\n\t\t// Setting defaults\r\n\t\tthis.options = Object.assign(this.defaults, options);\r\n\r\n\t\tif (this.options.backgroundColor) {\r\n\t\t\t// This is being deprecated in favor of using the style HTML DOM property\r\n\t\t\tconsole.warn('DEPRECATION NOTICE: \"backgroundColor\" is being deprecated. Please use the \"style.background\" property.');\r\n\t\t}\r\n\r\n\t\tthis.toastElement = null;\r\n\r\n\t\tthis.options.gravity = options.gravity === \"bottom\" ? \"toastify-bottom\" : \"toastify-top\"; // toast position - top or bottom\r\n\t\tthis.options.stopOnFocus = options.stopOnFocus === undefined ? true : options.stopOnFocus; // stop timeout on focus\r\n\t\tif(options.backgroundColor) {\r\n\t\t\tthis.options.style.background = options.backgroundColor;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Build the Toastify element\r\n\t * @returns {Element}\r\n\t * @private\r\n\t */\r\n\t_buildToast() {\r\n\t\t// Validating if the options are defined\r\n\t\tif (!this.options) {\r\n\t\t\tthrow \"Toastify is not initialized\";\r\n\t\t}\r\n\r\n\t\t// Creating the DOM object\r\n\t\tlet divElement = document.createElement(\"div\");\r\n\t\tdivElement.className = `toastify on ${this.options.className}`;\r\n\r\n\t\t// Positioning toast to left or right or center (default right)\r\n\t\tdivElement.className += ` toastify-${this.options.position}`;\r\n\r\n\t\t// Assigning gravity of element\r\n\t\tdivElement.className += ` ${this.options.gravity}`;\r\n\r\n\t\t// Loop through our style object and apply styles to divElement\r\n\t\tfor (const property in this.options.style) {\r\n\t\t\tdivElement.style[property] = this.options.style[property];\r\n\t\t}\r\n\r\n\t\t// Announce the toast to screen readers\r\n\t\tif (this.options.ariaLive) {\r\n\t\t\tdivElement.setAttribute('aria-live', this.options.ariaLive)\r\n\t\t}\r\n\r\n\t\t// Adding the toast message/node\r\n\t\tif (this.options.node && this.options.node.nodeType === Node.ELEMENT_NODE) {\r\n\t\t\t// If we have a valid node, we insert it\r\n\t\t\tdivElement.appendChild(this.options.node)\r\n\t\t} else {\r\n\t\t\tif (this.options.escapeMarkup) {\r\n\t\t\t\tdivElement.innerText = this.options.text;\r\n\t\t\t} else {\r\n\t\t\t\t// FIXME: Uncaught TypeError: Failed to set the 'innerHTML' property on 'Element': This document requires 'TrustedHTML' assignment.\r\n\t\t\t\tdivElement.innerText = this.options.text;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.options.avatar !== \"\") {\r\n\t\t\t\tlet avatarElement = document.createElement(\"img\");\r\n\t\t\t\tavatarElement.src = this.options.avatar;\r\n\r\n\t\t\t\tavatarElement.className = \"toastify-avatar\";\r\n\r\n\t\t\t\tif (this.options.position == \"left\") {\r\n\t\t\t\t\t// Adding close icon on the left of content\r\n\t\t\t\t\tdivElement.appendChild(avatarElement);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Adding close icon on the right of content\r\n\t\t\t\t\tdivElement.insertAdjacentElement(\"afterbegin\", avatarElement);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Adding a close icon to the toast\r\n\t\tif (this.options.close === true) {\r\n\t\t\t// Create a span for close element\r\n\t\t\tlet closeElement = document.createElement(\"button\");\r\n\t\t\tcloseElement.type = \"button\";\r\n\t\t\tcloseElement.setAttribute(\"aria-label\", \"Close\");\r\n\t\t\tcloseElement.className = \"toast-close\";\r\n\t\t\tcloseElement.innerText = \"X\";\r\n\r\n\t\t\t// Triggering the removal of toast from DOM on close click\r\n\t\t\tcloseElement.addEventListener(\r\n\t\t\t\t\"click\",\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tthis._removeElement(this.toastElement);\r\n\t\t\t\t\twindow.clearTimeout(this.toastElement.timeOutValue);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\t//Calculating screen width\r\n\t\t\tconst width = window.innerWidth > 0 ? window.innerWidth : screen.width;\r\n\r\n\t\t\t// Adding the close icon to the toast element\r\n\t\t\t// Display on the right if screen width is less than or equal to 360px\r\n\t\t\tif ((this.options.position == \"left\") && width > 360) {\r\n\t\t\t\t// Adding close icon on the left of content\r\n\t\t\t\tdivElement.insertAdjacentElement(\"afterbegin\", closeElement);\r\n\t\t\t} else {\r\n\t\t\t\t// Adding close icon on the right of content\r\n\t\t\t\tdivElement.appendChild(closeElement);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Clear timeout while toast is focused\r\n\t\tif (this.options.stopOnFocus && this.options.duration > 0) {\r\n\t\t\t// stop countdown\r\n\t\t\tdivElement.addEventListener(\r\n\t\t\t\t\"mouseover\",\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\twindow.clearTimeout(divElement.timeOutValue);\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t\t// add back the timeout\r\n\t\t\tdivElement.addEventListener(\r\n\t\t\t\t\"mouseleave\",\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdivElement.timeOutValue = window.setTimeout(\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t// Remove the toast from DOM\r\n\t\t\t\t\t\t\tthis._removeElement(divElement);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tthis.options.duration\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\t// Adding an on-click destination path\r\n\t\tif (typeof this.options.destination !== \"undefined\") {\r\n\t\t\tdivElement.addEventListener(\r\n\t\t\t\t\"click\",\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tif (this.options.newWindow === true) {\r\n\t\t\t\t\t\twindow.open(this.options.destination, \"_blank\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twindow.location = this.options.destination;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (typeof this.options.onClick === \"function\" && typeof this.options.destination === \"undefined\") {\r\n\t\t\tdivElement.addEventListener(\r\n\t\t\t\t\"click\",\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tthis.options.onClick();\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Adding offset\r\n\t\tif (typeof this.options.offset === \"object\") {\r\n\r\n\t\t\tconst x = this._getAxisOffsetAValue(\"x\", this.options);\r\n\t\t\tconst y = this._getAxisOffsetAValue(\"y\", this.options);\r\n\r\n\t\t\tconst xOffset = this.options.position == \"left\" ? x : `-${x}`;\r\n\t\t\tconst yOffset = this.options.gravity == \"toastify-top\" ? y : `-${y}`;\r\n\r\n\t\t\tdivElement.style.transform = `translate(${xOffset},${yOffset})`;\r\n\r\n\t\t}\r\n\r\n\t\t// Returning the generated element\r\n\t\treturn divElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Remove the toast from the DOM\r\n\t * @param {Element} toastElement\r\n\t */\r\n\t_removeElement(toastElement) {\r\n\t\t// Hiding the element\r\n\t\ttoastElement.className = toastElement.className.replace(\" on\", \"\");\r\n\r\n\t\t// Removing the element from DOM after transition end\r\n\t\twindow.setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\t// remove options node if any\r\n\t\t\t\tif (this.options.node && this.options.node.parentNode) {\r\n\t\t\t\t\tthis.options.node.parentNode.removeChild(this.options.node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove the element from the DOM, only when the parent node was not removed before.\r\n\t\t\t\tif (toastElement.parentNode) {\r\n\t\t\t\t\ttoastElement.parentNode.removeChild(toastElement);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Calling the callback function\r\n\t\t\t\tthis.options.callback.call(toastElement);\r\n\r\n\t\t\t\t// Repositioning the toasts again\r\n\t\t\t\tthis._reposition();\r\n\t\t\t},\r\n\t\t\t400\r\n\t\t); // Binding `this` for function invocation\r\n\t}\r\n\r\n\t/**\r\n\t * Position the toast on the DOM\r\n\t * @private\r\n\t */\r\n\t_reposition() {\r\n\r\n\t\t// Top margins with gravity\r\n\t\tlet topLeftOffsetSize = {\r\n\t\t\ttop: 15,\r\n\t\t\tbottom: 15,\r\n\t\t};\r\n\t\tlet topRightOffsetSize = {\r\n\t\t\ttop: 15,\r\n\t\t\tbottom: 15,\r\n\t\t};\r\n\t\tlet offsetSize = {\r\n\t\t\ttop: 15,\r\n\t\t\tbottom: 15,\r\n\t\t};\r\n\r\n\t\t// Get all toast messages that have been added to the container (selector)\r\n\t\tlet allToasts = this._rootElement.querySelectorAll(\".toastify\");\r\n\r\n\t\tlet classUsed;\r\n\r\n\t\t// Modifying the position of each toast element\r\n\t\tfor (let i = 0; i < allToasts.length; i++) {\r\n\t\t\t// Getting the applied gravity\r\n\t\t\tif (allToasts[i].classList.contains(\"toastify-top\") === true) {\r\n\t\t\t\tclassUsed = \"toastify-top\";\r\n\t\t\t} else {\r\n\t\t\t\tclassUsed = \"toastify-bottom\";\r\n\t\t\t}\r\n\r\n\t\t\tlet height = allToasts[i].offsetHeight;\r\n\t\t\tclassUsed = classUsed.substr(9, classUsed.length - 1)\r\n\t\t\t// Spacing between toasts\r\n\t\t\tlet offset = 15;\r\n\r\n\t\t\tlet width = window.innerWidth > 0 ? window.innerWidth : screen.width;\r\n\r\n\t\t\t// Show toast in center if screen with less than or equal to 360px\r\n\t\t\tif (width <= 360) {\r\n\t\t\t\t// Setting the position\r\n\t\t\t\tallToasts[i].style[classUsed] = `${offsetSize[classUsed]}px`;\r\n\r\n\t\t\t\toffsetSize[classUsed] += height + offset;\r\n\t\t\t} else {\r\n\t\t\t\tif (allToasts[i].classList.contains(\"toastify-left\") === true) {\r\n\t\t\t\t\t// Setting the position\r\n\t\t\t\t\tallToasts[i].style[classUsed] = `${topLeftOffsetSize[classUsed]}px`;\r\n\r\n\t\t\t\t\ttopLeftOffsetSize[classUsed] += height + offset;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Setting the position\r\n\t\t\t\t\tallToasts[i].style[classUsed] = `${topRightOffsetSize[classUsed]}px`;\r\n\r\n\t\t\t\t\ttopRightOffsetSize[classUsed] += height + offset;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function to get offset\r\n\t * @param {string} axis - 'x' or 'y'\r\n\t * @param {ToastifyConfigurationObject} options - The options object containing the offset object\r\n\t */\r\n\t_getAxisOffsetAValue(axis, options) {\r\n\r\n\t\tif (options.offset[axis]) {\r\n\t\t\tif (isNaN(options.offset[axis])) {\r\n\t\t\t\treturn options.offset[axis];\r\n\t\t\t} else {\r\n\t\t\t\treturn `${options.offset[axis]}px`;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn '0px';\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport const minifiedCss = `.toastify{padding:12px 20px;color:#fff;display:inline-block;box-shadow:0 3px 6px -1px rgba(0,0,0,.12),0 10px 36px -4px rgba(77,96,232,.3);background:-webkit-linear-gradient(315deg,#73a5ff,#5477f5);background:linear-gradient(135deg,#73a5ff,#5477f5);position:fixed;opacity:0;transition:all .4s cubic-bezier(.215, .61, .355, 1);border-radius:2px;cursor:pointer;text-decoration:none;max-width:calc(50% - 20px);z-index:2147483647}.toastify.on{opacity:1}.toast-close{background:0 0;border:0;color:#fff;cursor:pointer;font-family:inherit;font-size:1em;opacity:.4;padding:0 5px}.toastify-right{right:15px}.toastify-left{left:15px}.toastify-top{top:-150px}.toastify-bottom{bottom:-150px}.toastify-rounded{border-radius:25px}.toastify-avatar{width:1.5em;height:1.5em;margin:-7px 5px;border-radius:2px}.toastify-center{margin-left:auto;margin-right:auto;left:0;right:0;max-width:fit-content;max-width:-moz-fit-content}@media only screen and (max-width:360px){.toastify-left,.toastify-right{margin-left:auto;margin-right:auto;left:0;right:0;max-width:fit-content}}`\r\n","import { windowId, extensionScriptSrc } from './keys'\r\nimport { Toastify, minifiedCss } from '../shared/toast.js'\r\nimport { deltaFn } from 'src/shared/utils'\r\n\r\nexport const stylesContainer =\r\n  document.getElementById(windowId) ?? document.createElement('div')\r\nstylesContainer.id = windowId\r\nconst workbenchScript = document.querySelector(`[src*=\"${extensionScriptSrc}\"]`)\r\nworkbenchScript?.setAttribute('state', 'stale')\r\ndocument.head.appendChild(workbenchScript!) // just fail... why not?\r\n\r\nexport function addRemoveRootStyles(add: boolean) {\r\n  if (add) {\r\n    workbenchScript?.setAttribute('state', 'active')\r\n    document.head.appendChild(stylesContainer)\r\n  } else {\r\n    workbenchScript?.setAttribute('state', 'inactive')\r\n    stylesContainer.remove()\r\n  }\r\n}\r\n\r\nconst levels = {\r\n  log: {\r\n    background: 'linear-gradient(to right, #292d3e, #31364a)',\r\n    'box-shadow': '0 3px 6px -1px #0000001f, 0 10px 36px -4px #4d60e84d',\r\n    border: '1px dotted #e3e4e229',\r\n  },\r\n  error: {\r\n    background: 'linear-gradient(to right, #ff4757, #6e1e38)',\r\n    'box-shadow': '0 3px 6px -1px #ff475796, 0 10px 36px -4px #a944424d',\r\n    border: '1px dotted #ff4757',\r\n  },\r\n  warn: {\r\n    background: 'linear-gradient(to right, #8a6d3b, #7a5b32)',\r\n    'box-shadow': '0 3px 6px -1px #8a6d3b70, 0 10px 36px -4px #8a6d3b4d',\r\n    border: '1px dotted #e3e4e229',\r\n  },\r\n  // success: {\r\n  //   background: 'linear-gradient(to right, #3c763d, #356635)',\r\n  //   'box-shadow': '0 3px 6px -1px #509d51b3, 0 10px 36px -4px #3c763d9c',\r\n  //   border: '1px dotted #e3e4e229',\r\n  // },\r\n} as const\r\n\r\n// Experiment with Proxy\r\nexport const toastConsole = new Proxy(\r\n  <Record<keyof typeof levels, Fn>>{}, // dangerous type casting\r\n  {\r\n    get(target, level: keyof typeof levels): Fn {\r\n      if (!(level in levels)) {\r\n        throw new Error('invalid console level')\r\n      }\r\n      return (message, objects, options = {}) => {\r\n        const print = 'Concise Syntax ' + level + ': ' + message\r\n        if (level == 'log') {\r\n          console.groupCollapsed(print, objects ?? {})\r\n          console.trace() // hidden in collapsed group\r\n          console.groupEnd()\r\n        } else if (level == 'warn') {\r\n          console.group('\\x1b[33m\\x1b[40m', `\\u26a0 ${print}`, objects ?? {})\r\n          console.trace()\r\n          console.groupEnd()\r\n          debugger\r\n        } else {\r\n          console.group('\\x1b[31m\\x1b[40m', `\\u26D4 ${print}`, objects ?? {})\r\n          console.trace()\r\n          console.groupEnd()\r\n          debugger\r\n        }\r\n        // FIXME: accommodate to the user's theme\r\n        const toastStyle = createStyles('toast')\r\n        toastStyle.styleIt(minifiedCss)\r\n        // FIXME: find a way to pass data to the actual vscode extension\r\n        const toast = new Toastify({\r\n          duration: 500_000,\r\n          close: true,\r\n          gravity: 'bottom',\r\n          position: 'left',\r\n          stopOnFocus: true,\r\n          style: levels[level],\r\n          text: message,\r\n          ...options,\r\n        })\r\n        // FIXME: find a way to trigger the actual vscode extension toast system\r\n        toast.showToast()\r\n      }\r\n    },\r\n  }\r\n)\r\ntype ToastOptions = {\r\n  onClick: (e: MouseEvent) => void\r\n  callback: () => void\r\n}\r\ntype Fn = (\r\n  message: string,\r\n  objects?: any,\r\n  options?: Partial<ToastOptions>\r\n) => void\r\n\r\nexport function createStyles(name: string) {\r\n  const id = windowId + '.' + name\r\n  const style =\r\n    stylesContainer.querySelector(`[id=\"${id}\"]`) ??\r\n    document.createElement('style')\r\n  style.id = id\r\n  stylesContainer.appendChild(style)\r\n\r\n  return {\r\n    element: style,\r\n    styleIt: (text: string) => styleIt(style, text),\r\n    dispose() {\r\n      style.textContent = ''\r\n    },\r\n  }\r\n}\r\n\r\nexport function styleIt(style: Element, text: string) {\r\n  return (style.textContent = text\r\n    .replace(/\\r|\\n/g, '')\r\n    .replaceAll(/\\t+/g, '\\n'))\r\n}\r\n\r\nexport type MutationOptions = {\r\n  added(node: Node): void\r\n  removed(node: Node): void\r\n  options: MutationObserverInit\r\n  target(): HTMLElement\r\n}\r\nexport function createMutation(props: MutationOptions) {\r\n  const observer = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      mutation.addedNodes.forEach(props.added)\r\n      mutation.removedNodes.forEach(props.removed)\r\n    }\r\n  })\r\n\r\n  return {\r\n    observe() {\r\n      // const target = props.target()\r\n      // props.added(target)\r\n      observer.observe(props.target(), props.options)\r\n    },\r\n    disconnect() {\r\n      // props.removed(props.target())\r\n      observer.disconnect()\r\n    },\r\n  }\r\n}\r\ntype MatchMutationOptions = {\r\n  added(node: HTMLElement): void\r\n  removed(node: HTMLElement): void\r\n  // filter(node: Node): boolean\r\n  options: MutationObserverInit\r\n  target(): HTMLElement\r\n}\r\n\r\nexport function specialChildrenMutation(props: MatchMutationOptions) {\r\n  const observer = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      for (const node of mutation.addedNodes) {\r\n        // if (props.filter(node)) {\r\n        props.added(node as any)\r\n        // }\r\n      }\r\n      for (const node of mutation.removedNodes) {\r\n        // if (props.filter(node)) {\r\n        props.removed(node as any)\r\n        // }\r\n      }\r\n    }\r\n  })\r\n\r\n  return {\r\n    stop() {\r\n      observer.takeRecords()\r\n      observer.disconnect()\r\n    },\r\n    plug(mapChildren?: (children: NodeListOf<ChildNode>) => ChildNode[]) {\r\n      const target = props.target()\r\n\r\n      ;(mapChildren?.(target.childNodes) ?? target.childNodes).forEach(\r\n        props.added as any\r\n      )\r\n      observer.observe(target, props.options)\r\n    },\r\n    unplug() {\r\n      const target = props.target()\r\n\r\n      target.childNodes.forEach(props.removed as any)\r\n      observer.disconnect()\r\n    },\r\n  }\r\n}\r\n\r\nexport function createStackedMutation<T>(options: {\r\n  added(node: Node): void\r\n  removed(node: Node): void\r\n  options: MutationObserverInit\r\n}) {\r\n  function add(node: Node) {\r\n    options.added(node)\r\n  }\r\n  function remove(node: Node) {\r\n    options.removed(node)\r\n  }\r\n\r\n  const observer = new MutationObserver((mutations) => {\r\n    mutations.forEach((mutation) => {\r\n      mutation.addedNodes.forEach(add)\r\n      mutation.removedNodes.forEach(remove)\r\n    })\r\n  })\r\n\r\n  return {\r\n    track(target: HTMLElement) {\r\n      add(target)\r\n      observer.observe(target, options.options)\r\n    },\r\n    untrack(target: HTMLElement) {\r\n      remove(target)\r\n      observer.disconnect()\r\n    },\r\n  }\r\n}\r\n\r\ntype D = string | undefined\r\n\r\nexport function createAttributeArrayMutation(props: {\r\n  watchAttribute: string[]\r\n  children?: boolean\r\n  change: (newAttributes: D[], oldAttributes: D[], node: HTMLElement) => void\r\n  target(): HTMLElement\r\n}) {\r\n  let previousData: D[] = []\r\n  const bridgeAttribute = (target: any): D[] =>\r\n    props.watchAttribute.map((a) => target?.getAttribute?.(a))\r\n\r\n  function change(target: HTMLElement) {\r\n    const newData = bridgeAttribute(target)\r\n    if (newData.every((d, i) => d === previousData[i])) return\r\n    const oldAttributes = [...previousData]\r\n    previousData = newData\r\n\r\n    props.change(newData, oldAttributes, target)\r\n  }\r\n  const observer = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      change(mutation.target as HTMLElement)\r\n    }\r\n  })\r\n  const options = {\r\n    attributes: true,\r\n    subtree: props.children,\r\n    // childList: props.children,\r\n    attributeFilter: props.watchAttribute,\r\n  }\r\n  return {\r\n    plug() {\r\n      const target = props.target()\r\n      change(target)\r\n      observer.observe(target, options)\r\n    },\r\n    stop() {\r\n      observer.takeRecords()\r\n      observer.disconnect()\r\n    },\r\n    disconnect() {\r\n      // change(props.target())\r\n\r\n      observer.disconnect()\r\n    },\r\n  }\r\n}\r\n\r\n// TODO: merge common ancestors with each invocation\r\n// TODO: test if this is more \"performant\" or just mental gymnastics\r\nexport function watchForRemoval(targetElement: Element, callback: Function) {\r\n  let done = false\r\n  let stack: Node[] = []\r\n  const rootObserver = new MutationObserver((mutationsList) => {\r\n    mutationsList.forEach((mutation) => {\r\n      if (\r\n        done ||\r\n        !stack.includes(mutation.target) ||\r\n        !mutation.removedNodes.length\r\n      )\r\n        return\r\n\r\n      const nodes = Array.from(mutation.removedNodes)\r\n      // console.log(mutation.target)\r\n\r\n      // direct match\r\n      if (\r\n        nodes.indexOf(targetElement) > -1 ||\r\n        // parent match\r\n        nodes.some((parent) => parent.contains(targetElement))\r\n      ) {\r\n        console.log('removed', targetElement, stack)\r\n        dispose()\r\n        callback()\r\n        return\r\n      }\r\n    })\r\n  })\r\n\r\n  function REC_ObserverAncestors(element: Element) {\r\n    if (!element.parentElement || element.parentElement === document.body) {\r\n      return\r\n    }\r\n    stack.push(element.parentElement)\r\n    rootObserver.observe(element.parentElement, { childList: true })\r\n    REC_ObserverAncestors(element.parentElement)\r\n  }\r\n\r\n  // Start observing ancestor hierarchy\r\n  REC_ObserverAncestors(targetElement)\r\n\r\n  function dispose() {\r\n    done = true\r\n    stack = []\r\n    rootObserver.takeRecords()\r\n    rootObserver.disconnect()\r\n  }\r\n  return dispose\r\n}\r\n\r\n/**\r\n * Die because of abstractions...\r\n */\r\nexport function innerChildrenMutation<T>(options: {\r\n  parent: HTMLElement\r\n  dispose?(): void\r\n  validate: (node: HTMLElement, cleanUp?: Function) => T\r\n  added(validPayload: NonNullable<T>): () => void\r\n  removed(node: HTMLElement, consume: Function): (() => void) | void\r\n}) {\r\n  let cleanUp = deltaFn()\r\n  const observer = specialChildrenMutation({\r\n    target: () => options.parent,\r\n    options: { childList: true },\r\n    added(node) {\r\n      const data = options.validate(node, cleanUp.fn)\r\n      if (!data) return\r\n      const res = options.added(data)\r\n      if (res) {\r\n        // FIXME: this might be a .consume() edge case\r\n        cleanUp.fn = res\r\n      }\r\n    },\r\n    removed(node) {\r\n      options.removed(node, cleanUp.consume)\r\n    },\r\n  })\r\n\r\n  observer.plug()\r\n  return () => {\r\n    options.dispose?.()\r\n    cleanUp.consume()\r\n    observer.stop()\r\n  }\r\n}\r\n// avoid circular dependency\r\nfunction e(unknown: any): unknown is HTMLElement {\r\n  return unknown instanceof HTMLElement\r\n}\r\n","import { deltaFn } from 'src/shared/utils'\r\nimport { toastConsole, watchForRemoval } from './shared'\r\n\r\nexport type LifecycleProps<T> = {\r\n  activate(dom: T): void | (() => void)\r\n  dom(): T & { check(): boolean; watchForRemoval: HTMLElement }\r\n  dispose?: () => void\r\n}\r\n\r\n/**\r\n * @description The **activate** function is called when the dom **check** passes. Then if the **item** is removed from the dom, the **dispose** function is called.\r\n *\r\n * Then it will try to **reload** the lifecycle.\r\n */\r\nexport function lifecycle<T>(props: LifecycleProps<T>) {\r\n  let running = false\r\n  let tryFn = createTryFunction({ fallback: clean })\r\n  let interval: NodeJS.Timeout\r\n  let disposeObserver = deltaFn()\r\n  let disposeActivate = deltaFn()\r\n\r\n  function patch() {\r\n    const dom = props.dom()\r\n    if (running || !dom.check()) return\r\n    running = true\r\n    clean()\r\n    tryFn(() => {\r\n      disposeObserver.fn = watchForRemoval(\r\n        dom.watchForRemoval,\r\n        function reload(delay = 5000) {\r\n          dispose()\r\n          interval = setInterval(patch, delay)\r\n        }\r\n      )\r\n      disposeActivate.fn = props.activate(dom)!\r\n    }, 'Lifecycle crashed unexpectedly when activating')\r\n  }\r\n  function dispose() {\r\n    clean()\r\n    tryFn(() => {\r\n      disposeActivate.consume()\r\n      disposeObserver.consume()\r\n\r\n      props.dispose?.()\r\n    }, 'Lifecycle crashed unexpectedly when disposing')\r\n    running = false\r\n  }\r\n\r\n  function clean() {\r\n    clearInterval(interval)\r\n  }\r\n\r\n  return {\r\n    get running() {\r\n      return running\r\n    },\r\n    activate(delay = 5000) {\r\n      if (running) {\r\n        debugger\r\n        toastConsole.error(\r\n          'Lifecycle already running, entering an impossible state'\r\n        )\r\n      }\r\n      if (\r\n        tryFn.guard('Lifecycle already crashed therefore not activating again')\r\n      ) {\r\n        return\r\n      }\r\n      clean()\r\n      interval = setInterval(patch, delay)\r\n    },\r\n    dispose() {\r\n      if (\r\n        tryFn.guard('Lifecycle already crashed therefore not disposing again')\r\n      ) {\r\n        return\r\n      }\r\n\r\n      dispose()\r\n    },\r\n  }\r\n}\r\n\r\ntype Guard = Partial<{ fallback: Function; message: string }>\r\n/**\r\n * TODO: This gotta be a pattern or something\r\n */\r\nexport function createTryFunction(guard?: Guard) {\r\n  let crashed = false\r\n\r\n  function tryFunction(fn: Function, message: string) {\r\n    if (crashed) return\r\n\r\n    try {\r\n      fn()\r\n    } catch (error) {\r\n      crashed = true\r\n      toastConsole.error('Fatal - ' + message, { error })\r\n    }\r\n  }\r\n  // assign a getter to the tryFunction\r\n  Object.defineProperty(tryFunction, 'crashed', {\r\n    get() {\r\n      return crashed\r\n    },\r\n  })\r\n  // assign a guard function to the tryFunction\r\n  tryFunction.guard = (action: Function | string) => {\r\n    if (crashed) {\r\n      // just pass a function bruh...\r\n      const fallback = action ?? guard?.fallback\r\n      if (typeof fallback === 'function') {\r\n        fallback()\r\n      }\r\n      const message = action ?? guard?.message\r\n      if (typeof message === 'string') {\r\n        console.warn(message)\r\n      }\r\n    }\r\n    return crashed\r\n  }\r\n  return tryFunction as typeof tryFunction & {\r\n    get crashed(): boolean\r\n  }\r\n}\r\n","import { bridgeBetweenVscodeExtension } from './keys'\r\nimport { lifecycle } from './lifecycle'\r\nimport { createAttributeArrayMutation, innerChildrenMutation } from './shared'\r\nimport type { IState, ICalibrate } from '../shared/state'\r\nimport type { stateObservable, calibrateObservable } from './index'\r\n\r\n/**\r\n * @description When the vscode extension changes the \"bridge attribute\" apply custom styles\r\n *\r\n * Take a look at: regexToDomToCss.ts to see how the styles are generated\r\n */\r\nexport function createSyntaxLifecycle(\r\n  observable: typeof stateObservable | typeof calibrateObservable,\r\n  state: typeof IState | typeof ICalibrate,\r\n  props?: { activate: () => () => void }\r\n) {\r\n  return lifecycle<{ watchForRemoval: H }>({\r\n    dom() {\r\n      const statusBar = document.querySelector('footer .right-items') as H\r\n      return {\r\n        watchForRemoval: statusBar,\r\n        check() {\r\n          return !!document.contains(statusBar?.parentNode)\r\n        },\r\n      }\r\n    },\r\n    activate(DOM) {\r\n      // FIXME: share a single mutation\r\n      return innerChildrenMutation({\r\n        parent: DOM.watchForRemoval,\r\n        validate(node, busy) {\r\n          if (busy) return\r\n          const item = DOM.watchForRemoval?.querySelector(state.selector) as H\r\n          const icon = item?.querySelector('.codicon') as H\r\n          if (!item || !icon) return\r\n          return { icon, item }\r\n        },\r\n        added(dom) {\r\n          const attributeObserver = createAttributeArrayMutation({\r\n            target: () => dom.item,\r\n            watchAttribute: [bridgeBetweenVscodeExtension],\r\n            change([bridge]) {\r\n              const delta = state.decode(bridge)\r\n              if (!delta || observable.value === delta) return\r\n              observable.value = delta\r\n            },\r\n          })\r\n\r\n          attributeObserver.plug()\r\n          return attributeObserver.stop\r\n        },\r\n        removed(node, consume) {\r\n          if (node.matches(state.selector)) {\r\n            consume()\r\n          }\r\n        },\r\n        dispose: props?.activate(),\r\n      })\r\n    },\r\n  })\r\n}\r\n\r\ntype H = HTMLElement\r\n","import {\r\n  currentSelector,\r\n  editorSelector,\r\n  overlaySelector,\r\n  selectedSelector,\r\n  splitViewContainerSelector,\r\n} from './keys'\r\nimport { stylesContainer, toastConsole } from './shared'\r\n\r\nexport function clear(label?: string) {\r\n  stylesContainer\r\n    .querySelectorAll(label ? `[aria-label=\"${label}\"]` : '[aria-label]')\r\n    .forEach((style) => style.remove())\r\n}\r\nexport const styles = {\r\n  clear(label: string) {\r\n    clear(label)\r\n  },\r\n  clearOverlays() {\r\n    clear()\r\n  },\r\n  getOrCreateLabeledStyle(label: string, selector: string) {\r\n    let style = stylesContainer.querySelector(\r\n      `[aria-label=\"${label}\"][selector=\"${selector}\"]`\r\n    ) as HTMLElement\r\n    if (!style || !stylesContainer.contains(style)) {\r\n      style = document.createElement('style')\r\n      style.setAttribute('aria-label', label)\r\n      style.setAttribute('selector', selector)\r\n      stylesContainer.appendChild(style)\r\n    }\r\n    return style\r\n  },\r\n  swapLabeledStyle(oldLabel: string, newLabel: string) {\r\n    const styles = stylesContainer.querySelectorAll(\r\n      `[aria-label=\"${oldLabel}\"]`\r\n    )\r\n    styles.forEach((style) => {\r\n      style.setAttribute('aria-label', newLabel)\r\n      style.textContent = style.textContent?.replace(oldLabel, newLabel) ?? ''\r\n    })\r\n  },\r\n}\r\n\r\nexport type Selected = {\r\n  node: Node\r\n  selector: string\r\n  add: boolean\r\n  set: Set<number>\r\n  color: string\r\n  label: string\r\n}\r\nexport function tryGetAttribute(\r\n  line: HTMLElement,\r\n  attribute: string\r\n): string | undefined {\r\n  // @ts-ignore\r\n  return (line.editor =\r\n    line.closest(`[${attribute}]`)?.getAttribute(attribute) ??\r\n    // @ts-ignore\r\n    line.editor)\r\n}\r\n\r\nexport function findScopeElements(view: HTMLElement) {\r\n  type H = HTMLElement | null\r\n  const container = view.querySelector(':scope > div > .editor-container') as H\r\n  const nested = view.querySelector(\r\n    ':scope > div > div > div > .split-view-container'\r\n  ) as H\r\n  const editor = container?.querySelector(editorSelector) as H\r\n  const overlay = editor?.querySelector(overlaySelector) as H\r\n  const anyLine = overlay?.querySelector(\r\n    `${selectedSelector}, ${currentSelector}`\r\n  ) as H\r\n  return { nested, container, editor, overlay, anyLine }\r\n}\r\nfunction lookup(node: Node | null, up: number): Node {\r\n  return Array(up)\r\n    .fill(0)\r\n    .reduce((acc, _) => acc?.parentElement, node)\r\n}\r\nexport function lookupTo(\r\n  node: Node | null,\r\n  up: number,\r\n  to: Node\r\n): node is HTMLElement {\r\n  return lookup(node, up) === to\r\n}\r\n\r\nexport function e(el: unknown): el is HTMLElement {\r\n  return el instanceof HTMLElement\r\n}\r\n\r\nexport function consumeStack(\r\n  stack: Map<HTMLElement, Function>,\r\n  key: HTMLElement\r\n) {\r\n  // if (stack.has(key)) { // it's better if it fails so we can fix it\r\n  stack.get(key)?.()\r\n  stack.delete(key)\r\n  // }\r\n}\r\n\r\nexport function guardStack(\r\n  stack: Map<HTMLElement, Function>,\r\n  key: HTMLElement,\r\n  cleanup: Function\r\n) {\r\n  if (stack.has(key)) {\r\n    // TODO: figure out why this is happening\r\n    // toastConsole.warn('Highlight lifecycle stack already has this key', {\r\n    //   stack,\r\n    //   key,\r\n    // })\r\n    consumeStack(stack, key)\r\n  }\r\n  stack.set(key, cleanup)\r\n}\r\n\r\nexport function parseTopStyle(node: HTMLElement) {\r\n  return Number(node.style?.top.match(/\\d+/)?.[0])\r\n}\r\n\r\nexport function validateAddedView(node: Node, rebootCleanup?: Function) {\r\n  if (rebootCleanup) {\r\n    toastConsole.error('Reboot cleanup already exists', {\r\n      rebootCleanup,\r\n    })\r\n    return\r\n  }\r\n\r\n  type H = HTMLElement | undefined\r\n  if (!e(node)) {\r\n    toastConsole.warn('Reboot added node is not HTMLElement', { node })\r\n    return\r\n  }\r\n  const rootContainer = node.querySelector(splitViewContainerSelector) as H\r\n  if (!rootContainer) {\r\n    toastConsole.warn('Reboot rootContainer not found with selector', {\r\n      node,\r\n      splitViewContainerSelector,\r\n    })\r\n    return\r\n  }\r\n\r\n  // root.plug() special case, the first view never gets removed * sigh *\r\n  const [firstView, ...restViews] = rootContainer.childNodes\r\n  if (!e(firstView)) {\r\n    toastConsole.warn('Reboot first view element is not HTMLElement', {\r\n      rootContainer,\r\n      firstView,\r\n    })\r\n    return\r\n  }\r\n  let container = findScopeElements(firstView).container\r\n  if (!container) {\r\n    // FIXME: this is panic scenario\r\n    container = firstView.querySelector('.editor-container') as any\r\n    if (!container) {\r\n      // prettier-ignore\r\n      toastConsole.warn('Reboot container not found even without :scope selector', {\r\n\t\t\t\tfirstView,\r\n\t\t\t\tcontainer,\r\n\t\t\t})\r\n    }\r\n  }\r\n\r\n  if (container) {\r\n    return {\r\n      rootContainer,\r\n      firstView,\r\n      container,\r\n      restViews,\r\n    }\r\n  } else {\r\n    toastConsole.error('Reboot first view container not found', {\r\n      rootContainer,\r\n      firstView,\r\n    })\r\n  }\r\n}\r\n","import {\r\n  currentSelector,\r\n  highlightSelector,\r\n  idSelector,\r\n  linesSelector,\r\n  overlaySelector,\r\n  selectedSelector,\r\n  splitViewContainerSelector,\r\n} from './keys'\r\nimport { lifecycle } from './lifecycle'\r\nimport {\r\n  createAttributeArrayMutation,\r\n  specialChildrenMutation,\r\n  createMutation,\r\n  styleIt,\r\n  innerChildrenMutation,\r\n  toastConsole,\r\n} from './shared'\r\nimport {\r\n  Selected,\r\n  consumeStack,\r\n  e,\r\n  findScopeElements,\r\n  guardStack,\r\n  parseTopStyle,\r\n  styles,\r\n  validateAddedView,\r\n} from './utils'\r\nimport type { editorObservable } from './index'\r\n\r\n/**\r\n * @description Change color of highlighted or selected lines\r\n *\r\n * Take a look at the {createHighlight} function to see how the styles are generated\r\n */\r\nexport function createHighlightLifeCycle(\r\n  _editorObservable: typeof editorObservable\r\n) {\r\n  return lifecycle({\r\n    // prettier-ignore\r\n    dom() {\r\n      const gridRoot = document.querySelector('#workbench\\\\.parts\\\\.editor > div.content > div > div') as H\r\n      const root = gridRoot.querySelector(':scope > div > div > div.monaco-scrollable-element > ' + splitViewContainerSelector) as H\r\n      const editor = root?.querySelector(idSelector) as H\r\n      const overlays = editor?.querySelector(highlightSelector)?.parentElement as H\r\n      return {\r\n        check: () => !!overlays,\r\n        watchForRemoval: gridRoot,\r\n      }\r\n    },\r\n    activate(DOM) {\r\n      /**\r\n       * - split-view-container\r\n       * \t\t- split-view-view -> Recursion\r\n       * \t\t\t- editor-container\r\n       * \t\t\t\t- editor-instance\r\n       * \t\t\t\t\t- view-overlays\r\n       * \t\t\t\t\t\t\t- selected-text\r\n       * \t\t\t\t\t\t\t- current-line\r\n       */\r\n      const structure = createStackStructure(\r\n        DOM.watchForRemoval,\r\n        _editorObservable\r\n      )\r\n\r\n      return innerChildrenMutation({\r\n        parent: DOM.watchForRemoval,\r\n        dispose: structure.clearStacks,\r\n        validate: validateAddedView,\r\n        added(res) {\r\n          const recursiveViewTracker = structure.REC_EditorOverlayTracker(\r\n            res.rootContainer\r\n          )\r\n          // This is a special case, the first view never gets removed\r\n          const firsContainerTracker = specialChildrenMutation({\r\n            target: () => res.container,\r\n            options: { childList: true },\r\n            added() {\r\n              structure.REC_added(res.firstView)\r\n            },\r\n            removed() {\r\n              structure.bruteForceRemove(res.firstView)\r\n            },\r\n          })\r\n\r\n          recursiveViewTracker.plug(() => res.restViews)\r\n          firsContainerTracker.plug()\r\n          return () => {\r\n            recursiveViewTracker.stop()\r\n            firsContainerTracker.stop()\r\n          }\r\n        },\r\n        removed(node, consume) {\r\n          consume()\r\n        },\r\n      })\r\n    },\r\n    dispose() {\r\n      styles.clearOverlays()\r\n    },\r\n  })\r\n}\r\n\r\nfunction createHighlight({ node, selector, add, set, label, color }: Selected) {\r\n  if (!e(node) || !node.querySelector(selector)) return\r\n  const top = parseTopStyle(node)\r\n  if (\r\n    isNaN(top) ||\r\n    set.has(top) === add ||\r\n    (!add &&\r\n      // FIXME: figure out how to overcome vscode rapid dom swap at viewLayers.ts _finishRenderingInvalidLines\r\n      document.querySelector(\r\n        `[aria-label=\"${label}\"]` +\r\n          highlightSelector +\r\n          `>[style*=\"${top}\"]>` +\r\n          selector\r\n      ))\r\n  ) {\r\n    return\r\n  }\r\n\r\n  // funny code\r\n  set[add ? 'add' : 'delete'](top)\r\n\r\n  const lines = Array.from(set)\r\n    .reduce((acc, top) => acc + `[style*=\"${top}\"],`, '')\r\n    .slice(0, -1)\r\n\r\n  styleIt(\r\n    styles.getOrCreateLabeledStyle(label, selector),\r\n    `[aria-label=\"${label}\"]${linesSelector} :is(${lines}) {\r\n\t\t\t\t--r: .7;\r\n\t\t}`\r\n  )\r\n\r\n  return true\r\n}\r\n\r\nfunction editorOverlayLifecycle(\r\n  editor: HTMLElement,\r\n  _overlay: HTMLElement,\r\n  foundEditor: () => void\r\n) {\r\n  // lookup state\r\n  let editorLabel = editor.getAttribute('aria-label') as string | undefined\r\n  // when changing the textDocument the editor outlives the overlay\r\n  let deltaOverlay = _overlay as HTMLElement // | undefined\r\n\r\n  const EditorLanguageTracker = createAttributeArrayMutation({\r\n    target: () => editor,\r\n    watchAttribute: ['data-mode-id', 'aria-label'],\r\n    change([language, label], [, oldLabel]) {\r\n      editorLabel = label\r\n\r\n      if (!language || !label) {\r\n        if (oldLabel && label != oldLabel) {\r\n          styles.clear(oldLabel)\r\n        }\r\n        return\r\n      }\r\n\r\n      OverlayLineTracker.disconnect()\r\n\r\n      // FIXME: this is a panic scenario, should throw and exception or execute a failure callback\r\n      if (!editor.contains(deltaOverlay!)) {\r\n        // also if it fails to query the overlay, use the last one because a undefined overlay will cause a crash\r\n        deltaOverlay = editor?.querySelector<H>(overlaySelector) ?? deltaOverlay\r\n      }\r\n\r\n      if (label.match(/(\\.tsx$)|(\\.tsx, )/)) {\r\n        if (language === 'typescriptreact') {\r\n          OverlayLineTracker.observe()\r\n          bruteForceLayoutShift(foundEditor)\r\n        }\r\n        if (oldLabel && label != oldLabel) {\r\n          toastConsole.log('look! this gets executed...', oldLabel)\r\n        }\r\n      } else {\r\n        styles.clear(label)\r\n      }\r\n    },\r\n  })\r\n  function mount() {\r\n    selectedLines.clear()\r\n    currentLines.clear()\r\n    deltaOverlay.childNodes.forEach((node) => highlightStyles(node, true)) // if you restart vscode, there might be selected lines already\r\n  }\r\n\r\n  // lookup state\r\n  let selectedLines = new Set<number>()\r\n  let currentLines = new Set<number>()\r\n\r\n  const OverlayLineTracker = createMutation({\r\n    target: () => deltaOverlay,\r\n    options: {\r\n      childList: true,\r\n    },\r\n    added(node) {\r\n      highlightStyles(node, true)\r\n    },\r\n    removed(node) {\r\n      highlightStyles(node, false)\r\n    },\r\n  })\r\n\r\n  function highlightStyles(node: Node, add: boolean) {\r\n    if (!editorLabel) return\r\n    const pre = { node, add, label: editorLabel }\r\n    createHighlight({\r\n      selector: selectedSelector,\r\n      color: 'orange',\r\n      set: selectedLines,\r\n      ...pre,\r\n    }) ||\r\n      createHighlight({\r\n        selector: currentSelector,\r\n        color: 'brown',\r\n        set: currentLines,\r\n        ...pre,\r\n      })\r\n  }\r\n\r\n  // FIXME: find a better way to handle selected lines flickering and layout shifts\r\n  // issue: the top style shifts right before the last frame\r\n  let layoutShift: any\r\n  let tries = 0\r\n  const limit = 5\r\n  const lineTracker = (cb: Function) => {\r\n    tries += 1\r\n    if (tries > limit) {\r\n      cb()\r\n      clearInterval(layoutShift)\r\n      return\r\n    }\r\n    const line = deltaOverlay.querySelector(selectedSelector) as H\r\n    if (line && !isNaN(parseTopStyle(line))) {\r\n      mount()\r\n    }\r\n  }\r\n  function bruteForceLayoutShift(cb: Function) {\r\n    tries = 0\r\n    clearInterval(layoutShift)\r\n    layoutShift = setInterval(() => lineTracker(cb), 100)\r\n  }\r\n\r\n  EditorLanguageTracker.plug()\r\n\r\n  return function dispose() {\r\n    clearInterval(layoutShift)\r\n    if (editorLabel) {\r\n      styles.clear(editorLabel)\r\n    } else {\r\n      // FIXME: this is like leaking information that can't be clean up later\r\n      toastConsole.error('editorLabel is undefined')\r\n    }\r\n    EditorLanguageTracker.disconnect()\r\n    OverlayLineTracker.disconnect()\r\n  }\r\n}\r\n\r\nfunction createStackStructure(\r\n  watchForRemoval: HTMLElement,\r\n  _editorObservable: typeof editorObservable\r\n) {\r\n  let recStack = new Map<HTMLElement, Function>()\r\n  let editorStack = new Map<HTMLElement, Function>()\r\n  let treeStack = new Map<HTMLElement, Function>()\r\n  const REC_EditorOverlayTracker = (target: HTMLElement) =>\r\n    specialChildrenMutation({\r\n      target: () => target,\r\n      options: {\r\n        childList: true,\r\n      },\r\n      added: REC_added,\r\n      removed: bruteForceRemove,\r\n    })\r\n\r\n  function clearStacks(condition?: (keyNode: HTMLElement) => boolean) {\r\n    for (const stack of [recStack, editorStack, treeStack]) {\r\n      for (const [keyNode] of stack) {\r\n        if (condition && !condition(keyNode)) continue\r\n\r\n        consumeStack(stack, keyNode)\r\n      }\r\n    }\r\n  }\r\n  function awkwardStack(elements: ReturnType<typeof findScopeElements>) {\r\n    const { overlay, editor } = elements\r\n    if (overlay && editor && !editorStack.has(editor)) {\r\n      // TODO: get me out of here\r\n      const foundEditor = () => {\r\n        if (!watchForRemoval.contains(editor)) {\r\n          toastConsole.error('Editor not found _editorObservable')\r\n          return\r\n        }\r\n        _editorObservable.value = editor.getAttribute('aria-label')!\r\n      }\r\n      // toastConsole.log('awkwardStack')\r\n      editorStack.set(\r\n        editor,\r\n        editorOverlayLifecycle(editor, overlay, foundEditor)\r\n      )\r\n      return true\r\n    }\r\n  }\r\n  function REC_added(splitViewView: HTMLElement) {\r\n    // toastConsole.log('REC_added')\r\n    const elements = findScopeElements(splitViewView)\r\n\r\n    if (elements.nested) {\r\n      const rec = REC_EditorOverlayTracker(elements.nested)\r\n      rec.plug()\r\n\r\n      guardStack(recStack, splitViewView, rec.stop) // don't \"unplug\" because the unwinding will cause a stack overflow plus the \"removed\" method is currently brute force\r\n    } else if (awkwardStack(elements)) {\r\n      // noop\r\n    } else if (!elements.overlay) {\r\n      const treeTracker = specialChildrenMutation({\r\n        target: () => splitViewView,\r\n        options: {\r\n          childList: true,\r\n          subtree: true,\r\n        },\r\n        // FIXME: this should handle the mutation callback instead of each added node\r\n        added() {\r\n          const elements = findScopeElements(splitViewView)\r\n          if (awkwardStack(elements)) {\r\n            treeTracker.stop()\r\n            // TODO: maybe both recStack and treeStack could be cleared here without instead of brute force\r\n          }\r\n        },\r\n        // TODO: this is not needed\r\n        removed() {},\r\n      })\r\n\r\n      treeTracker.plug()\r\n      guardStack(treeStack, splitViewView, treeTracker.stop) // don't \"unplug\" because the unwinding will cause a stack overflow plus the \"removed\" method is currently brute force\r\n    }\r\n  }\r\n  function bruteForceRemove(splitViewView: HTMLElement) {\r\n    // FIXME: this should be handled by each cycle, there is an unhandled cleanup\r\n    clearStacks((keyNode) => !watchForRemoval.contains(keyNode))\r\n  }\r\n\r\n  return {\r\n    REC_EditorOverlayTracker,\r\n    clearStacks,\r\n    REC_added,\r\n    bruteForceRemove,\r\n  }\r\n}\r\ntype H = HTMLElement\r\n","import { extensionId } from '../workbench/keys'\r\n\r\nexport const stateIcon = 'symbol-keyword'\r\nexport const state = {\r\n  active: 'active',\r\n  inactive: 'inactive',\r\n  stale: 'stale',\r\n  disposed: 'disposed',\r\n  error: 'error',\r\n} as const\r\nexport type State = (typeof state)[keyof typeof state]\r\n/**\r\n * Exploit the fact that vscode will render strings to the DOM\r\n */\r\nexport const IState = {\r\n  selector: iconSelector(stateIcon),\r\n  encode(state: State) {\r\n    return `Concise Syntax: ${state}` as const\r\n  },\r\n  /**\r\n   * VSCode will reinterpret the string: \"<?icon>  <extensionName>, <?IState.encode>\"\r\n   * @param string\r\n   * @returns\r\n   */\r\n  decode(string?: string) {\r\n    return Object.values(state)\r\n      .reverse()\r\n      .find((state) => string?.includes(state))\r\n  },\r\n}\r\n\r\nexport const calibrateIcon = 'go-to-file'\r\nexport const calibrationFileName = 'syntax.tsx'\r\nexport const calibrate = {\r\n  opening: 'opening',\r\n  opened: 'opened',\r\n  closed: 'closed',\r\n  idle: 'idle',\r\n  error: 'error',\r\n} as const\r\n/**\r\n * standBy     nothing   / bootUp\r\n * requesting  click     / opening\r\n * loaded      dom/click / opened\r\n * windowState nothing   / closed\r\n *\r\n * noting/bootUp > click > opening > opened > dom/click > closed > standBy\r\n */\r\nexport type Calibrate = (typeof calibrate)[keyof typeof calibrate]\r\n/**\r\n * Exploit the fact that vscode will render strings to the DOM\r\n */\r\nexport const ICalibrate = {\r\n  selector: iconSelector(calibrateIcon),\r\n  encode(state: Calibrate) {\r\n    return `Concise Syntax (calibrate): ${state}` as const\r\n  },\r\n  /**\r\n   * VSCode will reinterpret the string: \"<?icon>  <extensionName>, <?IState.encode>\"\r\n   * @param string\r\n   * @returns\r\n   */\r\n  decode(string?: string) {\r\n    return Object.values(calibrate)\r\n      .reverse()\r\n      .find((state) => string?.includes(state))\r\n  },\r\n}\r\n\r\nfunction iconSelector(icon: string) {\r\n  return `[id=\"${extensionId}\"]:has(.codicon-${icon})` as const\r\n}\r\n","export function Clone<T extends object>(o: T, m?: any): T {\r\n  // return non object values\r\n  if ('object' !== typeof o) return o\r\n  // m: a map of old refs to new object refs to stop recursion\r\n  if ('object' !== typeof m || null === m) m = new WeakMap()\r\n  let n = m.get(o)\r\n  if ('undefined' !== typeof n) return n\r\n  // shallow/leaf clone object\r\n  let c = Object.getPrototypeOf(o).constructor\r\n  // TODO: specialize copies for expected built in types i.e. Date etc\r\n  switch (c) {\r\n    // shouldn't be copied, keep reference\r\n    case Boolean:\r\n    case Error:\r\n    case Function:\r\n    case Number:\r\n    case Promise:\r\n    case String:\r\n    case Symbol:\r\n    case WeakMap:\r\n    case WeakSet:\r\n      n = o\r\n      break\r\n    // array like/collection objects\r\n    case Array:\r\n      // @ts-ignore\r\n\r\n      m.set(o, (n = o.slice(0)))\r\n      // recursive copy for child objects\r\n      // @ts-ignore\r\n      n.forEach(function (v, i) {\r\n        if ('object' === typeof v) n[i] = Clone(v, m)\r\n      })\r\n      break\r\n    case ArrayBuffer:\r\n      // @ts-ignore\r\n      m.set(o, (n = o.slice(0)))\r\n      break\r\n    case DataView:\r\n      m.set(\r\n        o,\r\n        // @ts-ignore\r\n        (n = new c(Clone(o.buffer, m), o.byteOffset, o.byteLength))\r\n      )\r\n      break\r\n    case Map:\r\n    case Set:\r\n      // @ts-ignore\r\n      m.set(o, (n = new c(Clone(Array.from(o.entries()), m))))\r\n      break\r\n    case Int8Array:\r\n    case Uint8Array:\r\n    case Uint8ClampedArray:\r\n    case Int16Array:\r\n    case Uint16Array:\r\n    case Int32Array:\r\n    case Uint32Array:\r\n    case Float32Array:\r\n    case Float64Array:\r\n      // @ts-ignore\r\n      m.set(o, (n = new c(Clone(o.buffer, m), o.byteOffset, o.length)))\r\n      break\r\n    // use built in copy constructor\r\n    case Date:\r\n    case RegExp:\r\n      m.set(o, (n = new c(o)))\r\n      break\r\n    // fallback generic object copy\r\n    default:\r\n      m.set(o, (n = Object.assign(new c(), o)))\r\n      // recursive copy for child objects\r\n      for (c in n) if ('object' === typeof n[c]) n[c] = Clone(n[c], m)\r\n  }\r\n  return n\r\n}\r\n","import { type textMateRulesNames } from 'src/extension/settings'\r\nimport { linesSelector } from './keys'\r\nimport { Clone } from 'src/shared/clone'\r\n\r\n//#region tables\r\ntype Condition = (payload: {\r\n  siblings: HTMLSpanElement[]\r\n  current: HTMLSpanElement\r\n}) => HTMLElement | undefined // FIXME: handle multiple return types\r\ntype SymbolClass<C = Condition> = {\r\n  [key in textMateRulesNames]?:\r\n    | {\r\n        match: RegExp | string\r\n        capture?: Condition\r\n      }\r\n    | ({\r\n        match: RegExp | string\r\n      } & Partial<{\r\n        [condition: string]: C\r\n      }>)\r\n}\r\n\r\nconst symbolTable = {\r\n  'tag.begin': {\r\n    match: /<|<\\//,\r\n    entity({ siblings, current }) {\r\n      const tag = siblings[siblings.indexOf(current) + 1]\r\n      if (tag.textContent?.toLowerCase() === tag.textContent) {\r\n        return tag\r\n      }\r\n    },\r\n    component({ siblings, current }) {\r\n      const tag = siblings[siblings.indexOf(current) + 1]\r\n      if (tag.textContent?.match(/^[A-Z]/)) {\r\n        return tag\r\n      }\r\n    },\r\n  },\r\n  text: { match: /Hello\\sConcise\\sSyntax!/ },\r\n  comma: {\r\n    match: /,/,\r\n    capture({ siblings, current }) {\r\n      const next = siblings[siblings.indexOf(current) + 1]\r\n      if (next) {\r\n        return current\r\n      }\r\n    },\r\n  },\r\n  ternary: { match: /\\?/ },\r\n} satisfies SymbolClass\r\n\r\nconst lastSymbolTable = {\r\n  'tag.end': {\r\n    match: /(>|\\/>)$/,\r\n    capture({ siblings }) {\r\n      return siblings[siblings.length - 1]\r\n    },\r\n  },\r\n  terminator: {\r\n    match: /;$/,\r\n    capture({ siblings }) {\r\n      return siblings[siblings.length - 1]\r\n    },\r\n  },\r\n  lastComma: {\r\n    match: /,$/,\r\n    capture({ siblings }) {\r\n      return siblings[siblings.length - 1]\r\n    },\r\n  },\r\n  'bracket.begin': {\r\n    match: /={{$/,\r\n    capture({ siblings }) {\r\n      return siblings[siblings.length - 2]\r\n    },\r\n  },\r\n  ternaryOtherwise: {\r\n    match: /\\).+?:.+\\}/,\r\n    // FIXME: type me\r\n    capture({ siblings, current }) {\r\n      return siblings\r\n    },\r\n  },\r\n} satisfies SymbolClass\r\n\r\nconst multipleSymbolTale = {\r\n  quotes: {\r\n    match: /\"|'|`/,\r\n    string({ siblings, current }) {\r\n      const beginQuote = current.textContent\r\n      const string = siblings[siblings.indexOf(current) + 1]\r\n      const end = siblings[siblings.indexOf(current) + 2]\r\n      const endQuote = end?.textContent\r\n      if (\r\n        beginQuote?.length == 1 &&\r\n        string?.textContent?.length &&\r\n        beginQuote === endQuote\r\n      ) {\r\n        return [current, string, end]\r\n      } else if (beginQuote?.length! > 2 && beginQuote?.match(/(\"|'|`)$/)) {\r\n        return [current]\r\n      }\r\n    },\r\n  },\r\n} satisfies SymbolClass<\r\n  (payload: {\r\n    siblings: HTMLSpanElement[]\r\n    current: HTMLSpanElement\r\n  }) => HTMLElement[] | undefined\r\n>\r\n//#endregion\r\n\r\n/**\r\n * FIXME: This function might crash if it can't find valid selectors...\r\n * FIXME: the types are overloaded but correct, fix them\r\n */\r\nexport function parseSymbolColors(lineEditor: HTMLElement) {\r\n  //#region parser\r\n  const lineSelector = 'div>span'\r\n  const lines = Array.from(lineEditor.querySelectorAll(lineSelector))\r\n\r\n  let table: any = Clone(symbolTable)\r\n  let lastTable: any = Clone(lastSymbolTable)\r\n  let multipleTable: any = Clone(multipleSymbolTale)\r\n  let output: any = {}\r\n\r\n  parser: for (const line of lines) {\r\n    const text = line.textContent\r\n    if (!text) continue\r\n    const siblings = Array.from(line.children) as HTMLElement[]\r\n\r\n    line: for (let current of siblings) {\r\n      const content = current.textContent\r\n\r\n      for (let key in table) {\r\n        const regex = table[key].match\r\n        const match = content?.match(regex)\r\n        if (!match) continue\r\n        output[key] ??= {}\r\n        delete table[key].match\r\n\r\n        for (let conditionKey in table[key]) {\r\n          const evaluation = table[key][conditionKey]({\r\n            siblings,\r\n            current,\r\n          })\r\n          if (evaluation) {\r\n            output[key][conditionKey] = getProcess(evaluation, match[0])\r\n            delete table[key][conditionKey]\r\n          }\r\n        }\r\n        if (Object.keys(table[key]).length === 0) {\r\n          output[key].capture ??= getProcess(current, match[0])\r\n          delete table[key]\r\n        } else {\r\n          table[key].match = regex\r\n        }\r\n      }\r\n\r\n      for (let key in multipleTable) {\r\n        const regex = multipleTable[key].match\r\n        const match = content?.match(regex)\r\n        if (!match) continue\r\n        output[key] ??= {}\r\n        delete multipleTable[key].match\r\n\r\n        for (let conditionKey in multipleTable[key]) {\r\n          const evaluations = multipleTable[key][conditionKey]({\r\n            siblings,\r\n            current,\r\n          })\r\n          if (evaluations) {\r\n            output[key][conditionKey] = evaluations.map(getProcess)\r\n            delete multipleTable[key][conditionKey]\r\n          }\r\n        }\r\n        if (Object.keys(multipleTable[key]).length === 0) {\r\n          output[key].capture ??= getProcess(current, match[0])\r\n          delete multipleTable[key]\r\n        } else {\r\n          multipleTable[key].match = regex\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let key in lastTable) {\r\n      const regex = lastTable[key].match\r\n      const match = text?.match(regex)\r\n      if (!match) continue\r\n      output[key] ??= {}\r\n\r\n      const evaluation = lastTable[key].capture({\r\n        siblings,\r\n      })\r\n      if (evaluation) {\r\n        output[key].capture = getProcess(evaluation, match[0])\r\n        delete lastTable[key]\r\n      }\r\n    }\r\n  }\r\n\r\n  // typescript...\r\n  type Table = typeof symbolTable\r\n  type TableKeyUnions<T> = { [K in keyof T]: { [K2 in keyof T[K]]: any } }\r\n  type AllKeys<T> = T extends any ? keyof T : never\r\n  type TableKeys =\r\n    | AllKeys<TableKeyUnions<typeof symbolTable>>\r\n    | AllKeys<TableKeyUnions<typeof lastSymbolTable>>\r\n    | AllKeys<TableKeyUnions<typeof multipleSymbolTale>>\r\n  type conditionKeys = AllKeys<TableKeyUnions<Table>[keyof Table]>\r\n  // FIXME: type me correctly...\r\n  const process = output as { [key in TableKeys]: { capture: HTMLElement } }\r\n  //#endregion\r\n\r\n  //#region map capture to pre selectors\r\n\r\n  const angleBracketSelector = setToSelector(\r\n    process['tag.begin'].capture,\r\n    process['tag.end'].capture\r\n  )\r\n  const anyTagSelector = `${angleBracketSelector}+${setToSelector(\r\n    process['tag.begin'].entity,\r\n    process['tag.begin'].component\r\n  )}`\r\n  const entityTagSelector = `${angleBracketSelector}+${classSelector(\r\n    process['tag.begin'].entity\r\n  )}`\r\n  const componentTagSelector = `${angleBracketSelector}+${classSelector(\r\n    process['tag.begin'].component\r\n  )}`\r\n\r\n  const bracketBeginSelector =\r\n    '.' + process['bracket.begin'].capture.className.split(' ').shift()\r\n\r\n  const stringEl = process.quotes.string[0]\r\n  const beginQuote = stringEl.className\r\n  const endQuoteEl = process.quotes.string[2] ?? stringEl\r\n  const endQuote = endQuoteEl.className\r\n\r\n  // why is this so bloated?\r\n  const ternaryOtherwiseSelector: string =\r\n    Array.from(process.ternaryOtherwise.capture as HTMLElement[])\r\n      .map((c) => Array.from(c.classList))\r\n      .reduce((acc, val) => acc.concat(val.join('.')), [])\r\n      .reduce((acc, val) => acc + '.' + val + '+', '')\r\n      .replaceAll(\r\n        /\\.bracket-highlighting-\\d/g,\r\n        '[class*=\"bracket-highlighting\"]'\r\n      )\r\n      .slice(0, -1) + ':last-child'\r\n  //#endregion\r\n\r\n  //#region map pre selectors to selectors with colors\r\n\r\n  const opacitySelectors = {\r\n    'tag.begin': {\r\n      selector: angleBracketSelector,\r\n      color: color(process['tag.begin'].capture),\r\n    },\r\n    lastComma: {\r\n      selector: lastChildSelector(process.lastComma.capture),\r\n      color: color(process.lastComma.capture),\r\n    },\r\n    terminator: {\r\n      selector: lastChildSelector(process.terminator.capture),\r\n      color: color(process.terminator.capture),\r\n    },\r\n    'string.begin': {\r\n      selector: '.' + beginQuote,\r\n      color: color(stringEl),\r\n    },\r\n    'string.end': {\r\n      selector: '.' + endQuote,\r\n      color: color(endQuoteEl),\r\n    },\r\n  } satisfies PartialColorSelector\r\n\r\n  const colorsSelectorOnly = {\r\n    'tag.entity': {\r\n      selector: `${entityTagSelector}`,\r\n      color: color(process['tag.begin'].entity),\r\n    },\r\n    'tag.component': {\r\n      selector: `${componentTagSelector}`,\r\n      color: color(process['tag.begin'].component),\r\n    },\r\n    comma: {\r\n      selector: classSelector(process.comma.capture),\r\n      color: color(process.comma.capture),\r\n    },\r\n    ternary: {\r\n      selector: classSelector(process.ternary.capture),\r\n      color: color(process.ternary.capture),\r\n    },\r\n  } satisfies PartialColorSelector\r\n  type PartialColorSelector = Partial<\r\n    Record<textMateRulesNames, { selector: string; color: string | undefined }>\r\n  >\r\n\r\n  const colorsOnly = {\r\n    'tag.end': {\r\n      color: color(process['tag.end'].capture),\r\n    },\r\n    text: {\r\n      color: color(process.text.capture),\r\n    },\r\n    'bracket.begin': {\r\n      color: color(process['bracket.begin'].capture),\r\n    },\r\n    'bracket.end': {\r\n      color: color(process['bracket.begin'].capture),\r\n    },\r\n  } satisfies Partial<Record<textMateRulesNames, { color: string | undefined }>>\r\n\r\n  const colorsTable = {\r\n    ...opacitySelectors,\r\n    ...colorsSelectorOnly,\r\n    ...colorsOnly,\r\n  }\r\n  // Test you are not missing any keys\r\n  colorsTable['' as textMateRulesNames]\r\n\r\n  const selectorOnly = {\r\n    closingTagEntity: {\r\n      selector: `${entityTagSelector}:has(+${angleBracketSelector}:last-child)`,\r\n    },\r\n    closingTagComponent: {\r\n      selector: `${componentTagSelector}:has(+${angleBracketSelector}:last-child)`,\r\n    },\r\n    emptyQuote: {\r\n      selector: `:is([class=\"${beginQuote}\"]:has(+.${endQuote}), [class=\"${beginQuote}\"]+.${endQuote})`,\r\n    },\r\n    bracketBegin: {\r\n      selector: bracketBeginSelector,\r\n    },\r\n    ternaryClosingBrace: {\r\n      selector: `${bracketBeginSelector}~${classSelector(\r\n        process.ternary.capture\r\n      )}~[class*=\"bracket-highlighting-\"]:last-child`,\r\n    },\r\n  }\r\n\r\n  const ternaryOtherwise = {\r\n    scope: `:has(${ternaryOtherwiseSelector})`,\r\n  }\r\n  //#endregion\r\n\r\n  const root = `${linesSelector}>${lineSelector}`\r\n  const payload = {\r\n    opacitySelectors,\r\n    selectorOnly,\r\n    colorSelectorOnly: colorsSelectorOnly,\r\n  }\r\n\r\n  // FIXME: crash if any color or selector are undefined\r\n  function checkMissingProps(obj: object) {\r\n    for (const [key, value] of Object.entries(obj)) {\r\n      if (typeof value === 'object') {\r\n        checkMissingProps(value)\r\n      } else if (!value) {\r\n        // prettier-ignore\r\n        throw new Error(`Missing property ${key} and possibly more...`)\r\n      }\r\n    }\r\n  }\r\n  checkMissingProps({\r\n    ...colorsTable,\r\n    ...selectorOnly,\r\n    ...ternaryOtherwise,\r\n  })\r\n\r\n  return {\r\n    colorsTable,\r\n    payload,\r\n    process(_payload: typeof payload) {\r\n      // FIXME: avoid mutations...\r\n      for (let key in payload) {\r\n        for (let key2 in payload[key]) {\r\n          if (_payload[key][key2]) {\r\n            payload[key][key2].color = _payload[key][key2].color\r\n          }\r\n        }\r\n      }\r\n      const { opacitySelectors, selectorOnly, colorSelectorOnly } = payload\r\n\r\n      const opacityValues = Object.values(opacitySelectors)\r\n\r\n      const selectorValues = [...opacityValues, ...Object.values(selectorOnly)]\r\n      const toUnion = selectorValues.map((f) => f.selector).join(',')\r\n\r\n      return `\r\n\t\t\t.view-lines {\r\n\t\t\t\t--r: 0;\r\n\t\t\t}\r\n\t\t\t.view-lines > div:hover,\r\n\t\t\t${root}>${selectorOnly.emptyQuote.selector} {\r\n\t\t\t\t--r: 1;\r\n\t\t\t}\r\n\t\t\t.view-lines:has(:is(${toUnion},${anyTagSelector}):hover),\r\n\t\t\t.view-lines:has(${lineSelector}:hover ${ternaryOtherwiseSelector}) {\r\n\t\t\t\t--r: .5;\r\n\t\t\t}\r\n\t\t\t${root} :is(${toUnion}),\r\n\t\t\t${root}:is(${ternaryOtherwise.scope}) {\r\n\t\t\t\topacity: var(--r);\r\n\t\t\t}\r\n\t\t\t`\r\n    },\r\n  }\r\n}\r\n\r\n//#region utils\r\nfunction classSelector(element: HTMLElement) {\r\n  return `.${Array.from(element.classList).join('.')}`\r\n}\r\nfunction lastChildSelector(element: HTMLElement) {\r\n  return `${classSelector(element)}:last-child`\r\n}\r\nfunction setToSelector(...elements: HTMLElement[]) {\r\n  const c = [...new Set(elements.map(classSelector))]\r\n  if (c.length === 1) {\r\n    return c[0]\r\n  } else {\r\n    return `:is(${c.join(', ')})`\r\n  }\r\n}\r\nfunction color(element: HTMLElement) {\r\n  return element.computedStyleMap().get('color')?.toString()\r\n}\r\nfunction getProcess(span: HTMLElement, match: string) {\r\n  return span\r\n}\r\n\r\n//#endregion\r\n","/**\r\n * Less Call Stack\r\n */\r\nexport function createObservable<T>(initialValue: T) {\r\n  let _value: T = initialValue\r\n  type SelfCleanup = (() => void) | 'Symbol.dispose' // is this well supported?\r\n  type Subscriber = (payload: T) => SelfCleanup | void\r\n  let _subscribers: Subscriber[] = []\r\n  let _toDispose = new Map<Subscriber, SelfCleanup[]>()\r\n\r\n  function splice(sub: Subscriber) {\r\n    _subscribers = _subscribers.filter((fn) => fn !== sub)\r\n    _toDispose.get(sub)?.forEach((fn) => typeof fn === 'function' && fn())\r\n    _toDispose.delete(sub)\r\n  }\r\n  return {\r\n    get value(): T {\r\n      return _value\r\n    },\r\n    set value(payload: T) {\r\n      if (_value === payload) return\r\n      _value = payload\r\n      this.notify()\r\n    },\r\n    notify() {\r\n      // debugger right now it is hardcoded... maybe after each subscriber callback _toDispose should be cleaned up\r\n      for (let i = 0; i < _subscribers.length; i++) {\r\n        const sub = _subscribers[i]\r\n        const res = sub(_value)\r\n\r\n        if (typeof res === 'function') {\r\n          // prettier-ignore\r\n          _toDispose.set(sub, (_toDispose.get(sub) || []).concat(res))\r\n        } else if (res === 'Symbol.dispose') {\r\n          splice(sub)\r\n          i -= 1\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * Subscribe without calling the callback immediately\r\n     */\r\n    $ubscribe(sub: Subscriber) {\r\n      _subscribers.push(sub)\r\n      return () => splice(sub)\r\n    },\r\n  }\r\n}\r\nexport type Observable<T> = ReturnType<typeof createObservable<T>>\r\n","import { createSyntaxLifecycle } from './syntax'\r\nimport { createHighlightLifeCycle } from './highlight'\r\nimport { extensionId, viewLinesSelector } from './keys'\r\nimport { IState, State, calibrationFileName, state } from 'src/shared/state'\r\nimport { ICalibrate, Calibrate, calibrate } from 'src/shared/state'\r\nimport { addRemoveRootStyles, createStyles, toastConsole } from './shared'\r\nimport { parseSymbolColors } from './regexToDomToCss'\r\nimport { createObservable } from '../shared/observable'\r\nimport { createTask, deltaFn } from 'src/shared/utils'\r\nimport { type calibrateWIndowPlaceholder } from 'src/extension/statusBarItem'\r\nimport {\r\n  BranchObserverTasks,\r\n  ObserverTasks,\r\n  createObservableTask,\r\n} from './observableTask'\r\nexport type { editorObservable, stateObservable, calibrateObservable }\r\n\r\nconst editorObservable = createObservable<undefined | string>(undefined)\r\nconst stateObservable = createObservable<State | undefined>(undefined)\r\nconst calibrateObservable = createObservable<Calibrate | undefined>(undefined)\r\n\r\nconst sessionKey = `${extensionId}.session.styles`\r\n\r\ncreateStyles('calibrate').styleIt(\r\n  `${ICalibrate.selector}{display: none !important}`\r\n)\r\n\r\nlet tableTask: ReturnType<typeof createTask<'opened' | 'idle'>> | undefined\r\nexport type windowColorsTable = ReturnType<\r\n  typeof parseSymbolColors\r\n>['colorsTable']\r\nconst createCalibrateSubscription = () =>\r\n  calibrateObservable.$ubscribe((state) => {\r\n    //#region opened -> idle -> reset\r\n    if (!(state == calibrate.opened || state == calibrate.idle)) return\r\n    // prettier-ignore\r\n    // FIXME: use proper uri or shared file path between extension and workbench\r\n    const lineEditor = document.querySelector<HTMLElement>(`[data-uri$=\"concise-syntax/out/${calibrationFileName}\"] ${viewLinesSelector}`)\r\n    if (!lineEditor) {\r\n      return toastConsole.error('Calibrate Editor not found')\r\n    }\r\n    if (tableTask && state == calibrate.opened) {\r\n      toastConsole.error('Calibrate Window already opened')\r\n      return\r\n    }\r\n\r\n    // FIXME: overcomplicated state for the sake of the following async procedure\r\n    if (!tableTask) {\r\n      tableTask = createTask()\r\n    } else if (state == calibrate.idle) {\r\n      tableTask.resolve(state)\r\n      return\r\n    }\r\n    //#endregion\r\n\r\n    syntaxStyle.dispose()\r\n    const snapshot = parseSymbolColors(lineEditor)\r\n    BonkersExecuteCommand(\r\n      'Concise Syntax',\r\n      'Calibrate Window' satisfies calibrateWIndowPlaceholder,\r\n      JSON.stringify(snapshot.colorsTable)\r\n    )\r\n      .catch(() => {\r\n        toastConsole.error('Failed to run Calibrate Window command')\r\n        BonkersExecuteCommand.shadow(false, getInput())\r\n      })\r\n      // FIXME: here is where the window should resolve the 'Calibrate Window' task\r\n      // take a look at src/extension/statusBarItem.ts calibrateStateSandbox procedure\r\n      .then(() => tableTask!.promise)\r\n      .catch(() => toastConsole.error('Failed to get colors table'))\r\n      .then(() => {\r\n        const css = parseSymbolColors(lineEditor).process(snapshot.payload)\r\n        window.localStorage.setItem(sessionKey, css)\r\n        syntaxStyle.styleIt(css)\r\n      })\r\n      .finally(() => (tableTask = undefined))\r\n  })\r\n\r\n//#region BonkersExecuteCommand\r\nconst calibrateWindowStyle = createStyles('calibrate.window')\r\n// prettier-ignore\r\nasync function BonkersExecuteCommand(displayName: string, commandName: string, value: string) {\r\n  BonkersExecuteCommand.shadow(true)\r\n  const widgetSelector = '.quick-input-widget'\r\n  const inputSelector = `${widgetSelector}:not([style*=\"display: none\"]) div.quick-input-box input`\r\n  let shadowInput: any\r\n  \r\n  const commandWidgetTasks = [\r\n    [\r\n      `${inputSelector}`,\r\n      (el) => {\r\n        shadowEventListeners(shadowInput=el)\r\n        el.value = `>${displayName}`\r\n        el.dispatchEvent(new Event('input'))\r\n      },\r\n    ],\r\n    [\r\n      `.quick-input-list [aria-label*=\"${displayName}: ${commandName}\"] label`,\r\n      (el) => el.click(),\r\n    ],\r\n    [\r\n      `${inputSelector}[placeholder=\"${commandName}\"]`,\r\n      (el) => {\r\n        el.value = value\r\n        el.dispatchEvent(new Event('input'))\r\n      },\r\n    ],\r\n    [\r\n      `${inputSelector}[title=\"${commandName}\"][aria-describedby=\"quickInput_message\"]`,\r\n      (el) => {\r\n        if (shadowInput !== el) {\r\n          return new Error('shadowInput!==target')\r\n        } else {\r\n          BonkersExecuteCommand.shadow(false, el)\r\n        }\r\n        el.dispatchEvent(\r\n          new KeyboardEvent('keydown', {\r\n            key: 'Enter',\r\n            code: 'Enter',\r\n            keyCode: 13,\r\n            which: 13,\r\n            bubbles: true,\r\n            cancelable: true,\r\n            composed: true,\r\n          })\r\n        )\r\n      },\r\n    ],\r\n  ] as const satisfies ObserverTasks\r\n  \r\n  const branchTasks = [\r\n    [\r\n      'li.action-item.command-center-center',\r\n      tapVsCode,\r\n      [widgetSelector, commandWidgetTasks]\r\n    ],\r\n    [\r\n      `.menubar-menu-button[aria-label=\"View\"]`,\r\n      tapVsCode,\r\n      [\r\n        `[class=\"action-item\"]:has([aria-label=\"Command Palette...\"])`,\r\n        tapVsCode,\r\n        [widgetSelector, commandWidgetTasks]\r\n      ]\r\n    ],\r\n  ] as const satisfies BranchObserverTasks\r\n  \r\n  // return await Promise.race([\r\n  //   createObservableTask(target,commandWidgetTasks),\r\n  //   new Promise((_,reject)=>setTimeout(()=>reject(new Error('timeout')), 5_000))\r\n  // ])\r\n\r\n  function tapVsCode(el:Element) {\r\n    el.dispatchEvent(new CustomEvent('-monaco-gesturetap', {}))\r\n  }\r\n  async function tries<T>(cb:()=>Promise<T|undefined>, n: number,t=500){\r\n    for (let i = 0; i < n; i++) {\r\n      if(i==n-1) { debugger }\r\n      const res = await cb()\r\n      if(res) return res\r\n      await hold(t)\r\n    }\r\n    return <any>undefined // better stack trace errors\r\n  }\r\n  function hold(t:number) {\r\n    return new Promise((resolve)=>setTimeout(resolve, t))\r\n  }\r\n}\r\nBonkersExecuteCommand.shadow = (block: boolean, input?: any) => {\r\n  const styles = block ? '' : '* {pointer-events:none;}'\r\n  calibrateWindowStyle.styleIt(styles)\r\n\r\n  const shadow = block ? shadowEventListeners : cleanShadowedEvents\r\n  shadow(window)\r\n  if (input) {\r\n    shadow(input) // FIXME: get me out of here\r\n  }\r\n}\r\nconst shadowEventListeners = events((e: Event) => {\r\n  e.preventDefault()\r\n  e.stopPropagation()\r\n  return false\r\n})\r\nconst cleanShadowedEvents = events(null)\r\nfunction events(fn: any) {\r\n  return (el: HTMLElement | Window) => {\r\n    // prettier-ignore\r\n    el.onclick=el.onkeydown=el.onkeyup=el.onmousedown=el.onmouseup=el.onblur=el.onfocus=fn\r\n  }\r\n}\r\ntype H = HTMLInputElement | undefined\r\nfunction getInput() {\r\n  return document.querySelector('div.quick-input-box input') as H\r\n}\r\n\r\n//#endregion\r\n\r\nfunction cacheProc() {\r\n  try {\r\n    const cache = window.localStorage.getItem(sessionKey)\r\n    if (cache) syntaxStyle.styleIt(cache)\r\n    else throw new Error('cache is empty')\r\n  } catch (error) {\r\n    window.localStorage.removeItem(sessionKey)\r\n  }\r\n}\r\nconst createEditorSubscription = () =>\r\n  editorObservable.$ubscribe((value) => {\r\n    if (!value) return\r\n    cacheProc()\r\n    return 'Symbol.dispose'\r\n  })\r\n\r\nconst syntaxStyle = createStyles('hide')\r\nlet deltaSubscribers = deltaFn()\r\n// Just use the \"using\" keyword...\r\nconst createStateSubscription = () =>\r\n  stateObservable.$ubscribe((deltaState) => {\r\n    if (deltaState == state.active) {\r\n      addRemoveRootStyles(true)\r\n      cacheProc()\r\n      calibration.activate(500)\r\n      highlight.activate(500) // FIXME: find the moment the css finishes loading\r\n      const _ = [createCalibrateSubscription(), createEditorSubscription()]\r\n      deltaSubscribers.fn = () => _.forEach((un) => un())\r\n    } else {\r\n      deltaSubscribers.consume()\r\n      addRemoveRootStyles(false)\r\n      syntaxStyle.dispose()\r\n      highlight.dispose() // the unwinding of the editorObservable could cause a stack overflow\r\n      calibration.dispose()\r\n    }\r\n  })\r\n\r\nconst syntax = createSyntaxLifecycle(stateObservable, IState, {\r\n  activate() {\r\n    const unSubscribeState = createStateSubscription()\r\n    return () => {\r\n      stateObservable.value = state.inactive\r\n      unSubscribeState()\r\n    }\r\n  },\r\n})\r\n// TODO: merge extension _calibrate and _state icons/bridges\r\nconst calibration = createSyntaxLifecycle(calibrateObservable, ICalibrate)\r\nconst highlight = createHighlightLifeCycle(editorObservable)\r\n\r\n// prettier-ignore\r\ndeclare global { interface Window { conciseSyntax?: typeof syntax } }\r\nif (window.conciseSyntax) {\r\n  window.conciseSyntax.dispose()\r\n}\r\nwindow.conciseSyntax = syntax\r\nsyntax.activate()\r\n\r\nconsole.log(extensionId, syntax)\r\n\r\n/**\r\n * FIXME\r\n * handle drastic user changes for example when changing vscode's profile\r\n */\r\n"],"names":["state","styles","color","top","watchForRemoval","elements","opacitySelectors","selectorOnly","e"],"mappings":"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"}