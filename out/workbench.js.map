{"version":3,"file":"workbench.js","sources":["../src/workbench/keys.ts","../src/shared/utils.ts","../src/shared/toast.js","../src/workbench/shared.ts","../src/workbench/lifecycle.ts","../src/workbench/syntax.ts","../src/workbench/utils.ts","../src/workbench/highlight.ts","../src/shared/state.ts","../src/workbench/regexToDomToCss.ts","../src/shared/observable.ts","../src/shared/or_return.ts","../src/workbench/index.ts"],"sourcesContent":["export const extensionId = 'kauderk.concise-syntax'\r\nexport const windowId = 'window.' + extensionId\r\n// exploit the fact that vscode renders data to the dom, could be any other attribute\r\nexport const bridgeBetweenVscodeExtension = 'aria-label'\r\nexport const customCSS = `\r\n\t.view-lines {\r\n\t\t--r: transparent;\r\n\t}\r\n\t.view-lines:has(.dummy:hover) {\r\n\t\t--r: red;\r\n\t}\r\n\t.dummy {\r\n\t\tcolor: var(--r);\r\n\t}\r\n\t`\r\n\r\nexport const editorSelector = '.editor-instance'\r\nexport const idSelector = '[data-mode-id=\"typescriptreact\"]'\r\nexport const viewLinesSelector = '.view-lines.monaco-mouse-cursor-text'\r\nexport const linesSelector = idSelector + ` ` + viewLinesSelector\r\nexport const overlaySelector = '.view-overlays'\r\nexport const highlightSelector = idSelector + ` ` + overlaySelector\r\nexport const selectedSelector = '.selected-text'\r\nexport const currentSelector = '.current-line'\r\nexport const languages = ['typescriptreact', 'javascriptreact']\r\nexport const splitViewContainerSelector = '.split-view-container'\r\n","export function deltaFn<F extends () => any>(consume: boolean = false) {\r\n  let delta: F | undefined\r\n  return {\r\n    consume() {\r\n      delta?.()\r\n      delta = undefined\r\n    },\r\n    get fn() {\r\n      return delta\r\n    },\r\n    set fn(value) {\r\n      // TODO: check if this won't break anything else\r\n      if (consume) this.consume()\r\n      delta = value\r\n    },\r\n  }\r\n}\r\nexport function deltaValue<T>(consume: (value: T) => void) {\r\n  let delta: T | undefined\r\n  return {\r\n    consume() {\r\n      if (delta) consume(delta)\r\n      delta = undefined\r\n    },\r\n    get value() {\r\n      return delta\r\n    },\r\n    set value(value) {\r\n      this.consume()\r\n      delta = value\r\n    },\r\n  }\r\n}\r\n","/*!\r\n* Toastify js 1.12.0\r\n* https://github.com/apvarun/toastify-js\r\n* @license MIT licensed\r\n*\r\n* Copyright (C) 2018 Varun A P\r\n*/\r\n\r\n/**\r\n * Options used for Toastify\r\n * @typedef {Object} ToastifyConfigurationObject\r\n * @property {string} text - Message to be displayed in the toast\r\n * @property {Element} node - Provide a node to be mounted inside the toast. node takes higher precedence over text\r\n * @property {number} duration - Duration for which the toast should be displayed. -1 for permanent toast\r\n * @property {string|Element} selector - CSS ID Selector on which the toast should be added\r\n * @property {url} destination - URL to which the browser should be navigated on click of the toast\r\n * @property {boolean} newWindow - Decides whether the destination should be opened in a new window or not\r\n * @property {boolean} close - To show the close icon or not\r\n * @property {string} gravity - To show the toast from top or bottom\r\n * @property {string} position - To show the toast on left or right\r\n * @property {string} backgroundColor - Deprecated: Sets the background color of the toast\r\n * @property {url} avatar - Image/icon to be shown before text\r\n * @property {string} className - Ability to provide custom class name for further customization\r\n * @property {boolean} stopOnFocus - To stop timer when hovered over the toast (Only if duration is set)\r\n * @property {(toastElement:HTMLElement)=>void} callback - Invoked when the toast is dismissed\r\n * @property {(e:MouseEvent)=>void} onClick - Invoked when the toast is clicked\r\n * @property {Object} offset - Ability to add some offset to axis\r\n * @property {boolean} escapeMarkup - Toggle the default behavior of escaping HTML markup\r\n * @property {string} ariaLive - Use the HTML DOM style property to add styles to toast\r\n * @property {Object} style - Use the HTML DOM style property to add styles to toast\r\n */\r\n\r\n\r\nexport class Toastify {\r\n\r\n\tdefaults = {\r\n\t\toldestFirst: true,\r\n\t\ttext: \"Toastify is awesome!\",\r\n\t\tnode: undefined,\r\n\t\tduration: 3000,\r\n\t\tselector: undefined,\r\n\t\tcallback: function() {},\r\n\t\tdestination: undefined,\r\n\t\tnewWindow: false,\r\n\t\tclose: false,\r\n\t\tgravity: \"toastify-top\",\r\n\t\tpositionLeft: false,\r\n\t\tposition: \"\",\r\n\t\tbackgroundColor: \"\",\r\n\t\tavatar: \"\",\r\n\t\tclassName: \"\",\r\n\t\tstopOnFocus: true,\r\n\t\tonClick: function() {},\r\n\t\toffset: { x: 0, y: 0 },\r\n\t\tescapeMarkup: true,\r\n\t\tariaLive: \"polite\",\r\n\t\tstyle: { background: \"\" },\r\n\t};\r\n\r\n\t/**\r\n\t * Create a new Toastify instance\r\n\t * @param {Partial<ToastifyConfigurationObject>} options - The configuration object to configure Toastify\r\n\t * \r\n\t*/ \r\n\tconstructor(options) {\r\n\t\t/**\r\n\t\t * The version of Toastify\r\n\t\t * @type {string}\r\n\t\t * @public\r\n\t\t */\r\n\t\tthis.version = \"1.12.0\";\r\n\r\n\t\t/**\r\n\t\t * The configuration object to configure Toastify\r\n\t\t * @type {ToastifyConfigurationObject}\r\n\t\t * @public\r\n\t\t */\r\n\t\tthis.options = {};\r\n\r\n\t\t/**\r\n\t\t * The element that is the Toast\r\n\t\t * @type {Element}\r\n\t\t * @public\r\n\t\t */\r\n\t\tthis.toastElement = null;\r\n\r\n\t\t/**\r\n\t\t * The root element that contains all the toasts\r\n\t\t * @type {Element}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._rootElement = document.body;\r\n\r\n\t\tthis._init(options);\r\n\t}\r\n\r\n\t/**\r\n\t * Display the toast\r\n\t * @public\r\n\t */\r\n\tshowToast() {\r\n\t\t// Creating the DOM object for the toast\r\n\t\tthis.toastElement = this._buildToast();\r\n\r\n\t\t// Getting the root element to with the toast needs to be added\r\n\t\tif (typeof this.options.selector === \"string\") {\r\n\t\t\tthis._rootElement = document.getElementById(this.options.selector);\r\n\t\t} else if (this.options.selector instanceof HTMLElement || this.options.selector instanceof ShadowRoot) {\r\n\t\t\tthis._rootElement = this.options.selector;\r\n\t\t} else {\r\n\t\t\tthis._rootElement = document.body;\r\n\t\t}\r\n\r\n\t\t// Validating if root element is present in DOM\r\n\t\tif (!this._rootElement) {\r\n\t\t\tthrow \"Root element is not defined\";\r\n\t\t}\r\n\r\n\t\t// Adding the DOM element\r\n\t\tthis._rootElement.insertBefore(this.toastElement, this._rootElement.firstChild);\r\n\r\n\t\t// Repositioning the toasts in case multiple toasts are present\r\n\t\tthis._reposition();\r\n\r\n\t\tif (this.options.duration > 0) {\r\n\t\t\tthis.toastElement.timeOutValue = window.setTimeout(\r\n\t\t\t\t() => {\r\n\t\t\t\t\t// Remove the toast from DOM\r\n\t\t\t\t\tthis._removeElement(this.toastElement);\r\n\t\t\t\t},\r\n\t\t\t\tthis.options.duration\r\n\t\t\t); // Binding `this` for function invocation\r\n\t\t}\r\n\r\n\t\t// Supporting function chaining\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Hide the toast\r\n\t * @public\r\n\t */\r\n\thideToast() {\r\n\t\tif (this.toastElement.timeOutValue) {\r\n\t\t\tclearTimeout(this.toastElement.timeOutValue);\r\n\t\t}\r\n\t\tthis._removeElement(this.toastElement);\r\n\t}\r\n\r\n\t/**\r\n\t * Init the Toastify class\r\n\t * @param {ToastifyConfigurationObject} options - The configuration object to configure Toastify\r\n\t * @param {string} [options.text=Hi there!] - Message to be displayed in the toast\r\n\t * @param {Element} [options.node] - Provide a node to be mounted inside the toast. node takes higher precedence over text\r\n\t * @param {number} [options.duration=3000] - Duration for which the toast should be displayed. -1 for permanent toast\r\n\t * @param {string} [options.selector] - CSS Selector on which the toast should be added\r\n\t * @param {url} [options.destination] - URL to which the browser should be navigated on click of the toast\r\n\t * @param {boolean} [options.newWindow=false] - Decides whether the destination should be opened in a new window or not\r\n\t * @param {boolean} [options.close=false] - To show the close icon or not\r\n\t * @param {string} [options.gravity=toastify-top] - To show the toast from top or bottom\r\n\t * @param {string} [options.position=right] - To show the toast on left or right\r\n\t * @param {string} [options.backgroundColor] - Sets the background color of the toast (To be deprecated)\r\n\t * @param {url} [options.avatar] - Image/icon to be shown before text\r\n\t * @param {string} [options.className] - Ability to provide custom class name for further customization\r\n\t * @param {boolean} [options.stopOnFocus] - To stop timer when hovered over the toast (Only if duration is set)\r\n\t * @param {Function} [options.callback] - Invoked when the toast is dismissed\r\n\t * @param {Function} [options.onClick] - Invoked when the toast is clicked\r\n\t * @param {Object} [options.offset] - Ability to add some offset to axis\r\n\t * @param {boolean} [options.escapeMarkup=true] - Toggle the default behavior of escaping HTML markup\r\n\t * @param {string} [options.ariaLive] - Announce the toast to screen readers\r\n\t * @param {Object} [options.style] - Use the HTML DOM style property to add styles to toast\r\n\t * @private\r\n\t */\r\n\t_init(options) {\r\n\r\n\t\t// Setting defaults\r\n\t\tthis.options = Object.assign(this.defaults, options);\r\n\r\n\t\tif (this.options.backgroundColor) {\r\n\t\t\t// This is being deprecated in favor of using the style HTML DOM property\r\n\t\t\tconsole.warn('DEPRECATION NOTICE: \"backgroundColor\" is being deprecated. Please use the \"style.background\" property.');\r\n\t\t}\r\n\r\n\t\tthis.toastElement = null;\r\n\r\n\t\tthis.options.gravity = options.gravity === \"bottom\" ? \"toastify-bottom\" : \"toastify-top\"; // toast position - top or bottom\r\n\t\tthis.options.stopOnFocus = options.stopOnFocus === undefined ? true : options.stopOnFocus; // stop timeout on focus\r\n\t\tif(options.backgroundColor) {\r\n\t\t\tthis.options.style.background = options.backgroundColor;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Build the Toastify element\r\n\t * @returns {Element}\r\n\t * @private\r\n\t */\r\n\t_buildToast() {\r\n\t\t// Validating if the options are defined\r\n\t\tif (!this.options) {\r\n\t\t\tthrow \"Toastify is not initialized\";\r\n\t\t}\r\n\r\n\t\t// Creating the DOM object\r\n\t\tlet divElement = document.createElement(\"div\");\r\n\t\tdivElement.className = `toastify on ${this.options.className}`;\r\n\r\n\t\t// Positioning toast to left or right or center (default right)\r\n\t\tdivElement.className += ` toastify-${this.options.position}`;\r\n\r\n\t\t// Assigning gravity of element\r\n\t\tdivElement.className += ` ${this.options.gravity}`;\r\n\r\n\t\t// Loop through our style object and apply styles to divElement\r\n\t\tfor (const property in this.options.style) {\r\n\t\t\tdivElement.style[property] = this.options.style[property];\r\n\t\t}\r\n\r\n\t\t// Announce the toast to screen readers\r\n\t\tif (this.options.ariaLive) {\r\n\t\t\tdivElement.setAttribute('aria-live', this.options.ariaLive)\r\n\t\t}\r\n\r\n\t\t// Adding the toast message/node\r\n\t\tif (this.options.node && this.options.node.nodeType === Node.ELEMENT_NODE) {\r\n\t\t\t// If we have a valid node, we insert it\r\n\t\t\tdivElement.appendChild(this.options.node)\r\n\t\t} else {\r\n\t\t\tif (this.options.escapeMarkup) {\r\n\t\t\t\tdivElement.innerText = this.options.text;\r\n\t\t\t} else {\r\n\t\t\t\t// FIXME: Uncaught TypeError: Failed to set the 'innerHTML' property on 'Element': This document requires 'TrustedHTML' assignment.\r\n\t\t\t\tdivElement.innerText = this.options.text;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.options.avatar !== \"\") {\r\n\t\t\t\tlet avatarElement = document.createElement(\"img\");\r\n\t\t\t\tavatarElement.src = this.options.avatar;\r\n\r\n\t\t\t\tavatarElement.className = \"toastify-avatar\";\r\n\r\n\t\t\t\tif (this.options.position == \"left\") {\r\n\t\t\t\t\t// Adding close icon on the left of content\r\n\t\t\t\t\tdivElement.appendChild(avatarElement);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Adding close icon on the right of content\r\n\t\t\t\t\tdivElement.insertAdjacentElement(\"afterbegin\", avatarElement);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Adding a close icon to the toast\r\n\t\tif (this.options.close === true) {\r\n\t\t\t// Create a span for close element\r\n\t\t\tlet closeElement = document.createElement(\"button\");\r\n\t\t\tcloseElement.type = \"button\";\r\n\t\t\tcloseElement.setAttribute(\"aria-label\", \"Close\");\r\n\t\t\tcloseElement.className = \"toast-close\";\r\n\t\t\tcloseElement.innerText = \"X\";\r\n\r\n\t\t\t// Triggering the removal of toast from DOM on close click\r\n\t\t\tcloseElement.addEventListener(\r\n\t\t\t\t\"click\",\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tthis._removeElement(this.toastElement);\r\n\t\t\t\t\twindow.clearTimeout(this.toastElement.timeOutValue);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\t//Calculating screen width\r\n\t\t\tconst width = window.innerWidth > 0 ? window.innerWidth : screen.width;\r\n\r\n\t\t\t// Adding the close icon to the toast element\r\n\t\t\t// Display on the right if screen width is less than or equal to 360px\r\n\t\t\tif ((this.options.position == \"left\") && width > 360) {\r\n\t\t\t\t// Adding close icon on the left of content\r\n\t\t\t\tdivElement.insertAdjacentElement(\"afterbegin\", closeElement);\r\n\t\t\t} else {\r\n\t\t\t\t// Adding close icon on the right of content\r\n\t\t\t\tdivElement.appendChild(closeElement);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Clear timeout while toast is focused\r\n\t\tif (this.options.stopOnFocus && this.options.duration > 0) {\r\n\t\t\t// stop countdown\r\n\t\t\tdivElement.addEventListener(\r\n\t\t\t\t\"mouseover\",\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\twindow.clearTimeout(divElement.timeOutValue);\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t\t// add back the timeout\r\n\t\t\tdivElement.addEventListener(\r\n\t\t\t\t\"mouseleave\",\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdivElement.timeOutValue = window.setTimeout(\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t// Remove the toast from DOM\r\n\t\t\t\t\t\t\tthis._removeElement(divElement);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tthis.options.duration\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\t// Adding an on-click destination path\r\n\t\tif (typeof this.options.destination !== \"undefined\") {\r\n\t\t\tdivElement.addEventListener(\r\n\t\t\t\t\"click\",\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tif (this.options.newWindow === true) {\r\n\t\t\t\t\t\twindow.open(this.options.destination, \"_blank\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twindow.location = this.options.destination;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (typeof this.options.onClick === \"function\" && typeof this.options.destination === \"undefined\") {\r\n\t\t\tdivElement.addEventListener(\r\n\t\t\t\t\"click\",\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tthis.options.onClick();\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Adding offset\r\n\t\tif (typeof this.options.offset === \"object\") {\r\n\r\n\t\t\tconst x = this._getAxisOffsetAValue(\"x\", this.options);\r\n\t\t\tconst y = this._getAxisOffsetAValue(\"y\", this.options);\r\n\r\n\t\t\tconst xOffset = this.options.position == \"left\" ? x : `-${x}`;\r\n\t\t\tconst yOffset = this.options.gravity == \"toastify-top\" ? y : `-${y}`;\r\n\r\n\t\t\tdivElement.style.transform = `translate(${xOffset},${yOffset})`;\r\n\r\n\t\t}\r\n\r\n\t\t// Returning the generated element\r\n\t\treturn divElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Remove the toast from the DOM\r\n\t * @param {Element} toastElement\r\n\t */\r\n\t_removeElement(toastElement) {\r\n\t\t// Hiding the element\r\n\t\ttoastElement.className = toastElement.className.replace(\" on\", \"\");\r\n\r\n\t\t// Removing the element from DOM after transition end\r\n\t\twindow.setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\t// remove options node if any\r\n\t\t\t\tif (this.options.node && this.options.node.parentNode) {\r\n\t\t\t\t\tthis.options.node.parentNode.removeChild(this.options.node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove the element from the DOM, only when the parent node was not removed before.\r\n\t\t\t\tif (toastElement.parentNode) {\r\n\t\t\t\t\ttoastElement.parentNode.removeChild(toastElement);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Calling the callback function\r\n\t\t\t\tthis.options.callback.call(toastElement);\r\n\r\n\t\t\t\t// Repositioning the toasts again\r\n\t\t\t\tthis._reposition();\r\n\t\t\t},\r\n\t\t\t400\r\n\t\t); // Binding `this` for function invocation\r\n\t}\r\n\r\n\t/**\r\n\t * Position the toast on the DOM\r\n\t * @private\r\n\t */\r\n\t_reposition() {\r\n\r\n\t\t// Top margins with gravity\r\n\t\tlet topLeftOffsetSize = {\r\n\t\t\ttop: 15,\r\n\t\t\tbottom: 15,\r\n\t\t};\r\n\t\tlet topRightOffsetSize = {\r\n\t\t\ttop: 15,\r\n\t\t\tbottom: 15,\r\n\t\t};\r\n\t\tlet offsetSize = {\r\n\t\t\ttop: 15,\r\n\t\t\tbottom: 15,\r\n\t\t};\r\n\r\n\t\t// Get all toast messages that have been added to the container (selector)\r\n\t\tlet allToasts = this._rootElement.querySelectorAll(\".toastify\");\r\n\r\n\t\tlet classUsed;\r\n\r\n\t\t// Modifying the position of each toast element\r\n\t\tfor (let i = 0; i < allToasts.length; i++) {\r\n\t\t\t// Getting the applied gravity\r\n\t\t\tif (allToasts[i].classList.contains(\"toastify-top\") === true) {\r\n\t\t\t\tclassUsed = \"toastify-top\";\r\n\t\t\t} else {\r\n\t\t\t\tclassUsed = \"toastify-bottom\";\r\n\t\t\t}\r\n\r\n\t\t\tlet height = allToasts[i].offsetHeight;\r\n\t\t\tclassUsed = classUsed.substr(9, classUsed.length - 1)\r\n\t\t\t// Spacing between toasts\r\n\t\t\tlet offset = 15;\r\n\r\n\t\t\tlet width = window.innerWidth > 0 ? window.innerWidth : screen.width;\r\n\r\n\t\t\t// Show toast in center if screen with less than or equal to 360px\r\n\t\t\tif (width <= 360) {\r\n\t\t\t\t// Setting the position\r\n\t\t\t\tallToasts[i].style[classUsed] = `${offsetSize[classUsed]}px`;\r\n\r\n\t\t\t\toffsetSize[classUsed] += height + offset;\r\n\t\t\t} else {\r\n\t\t\t\tif (allToasts[i].classList.contains(\"toastify-left\") === true) {\r\n\t\t\t\t\t// Setting the position\r\n\t\t\t\t\tallToasts[i].style[classUsed] = `${topLeftOffsetSize[classUsed]}px`;\r\n\r\n\t\t\t\t\ttopLeftOffsetSize[classUsed] += height + offset;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Setting the position\r\n\t\t\t\t\tallToasts[i].style[classUsed] = `${topRightOffsetSize[classUsed]}px`;\r\n\r\n\t\t\t\t\ttopRightOffsetSize[classUsed] += height + offset;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function to get offset\r\n\t * @param {string} axis - 'x' or 'y'\r\n\t * @param {ToastifyConfigurationObject} options - The options object containing the offset object\r\n\t */\r\n\t_getAxisOffsetAValue(axis, options) {\r\n\r\n\t\tif (options.offset[axis]) {\r\n\t\t\tif (isNaN(options.offset[axis])) {\r\n\t\t\t\treturn options.offset[axis];\r\n\t\t\t} else {\r\n\t\t\t\treturn `${options.offset[axis]}px`;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn '0px';\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport const minifiedCss = `.toastify{padding:12px 20px;color:#fff;display:inline-block;box-shadow:0 3px 6px -1px rgba(0,0,0,.12),0 10px 36px -4px rgba(77,96,232,.3);background:-webkit-linear-gradient(315deg,#73a5ff,#5477f5);background:linear-gradient(135deg,#73a5ff,#5477f5);position:fixed;opacity:0;transition:all .4s cubic-bezier(.215, .61, .355, 1);border-radius:2px;cursor:pointer;text-decoration:none;max-width:calc(50% - 20px);z-index:2147483647}.toastify.on{opacity:1}.toast-close{background:0 0;border:0;color:#fff;cursor:pointer;font-family:inherit;font-size:1em;opacity:.4;padding:0 5px}.toastify-right{right:15px}.toastify-left{left:15px}.toastify-top{top:-150px}.toastify-bottom{bottom:-150px}.toastify-rounded{border-radius:25px}.toastify-avatar{width:1.5em;height:1.5em;margin:-7px 5px;border-radius:2px}.toastify-center{margin-left:auto;margin-right:auto;left:0;right:0;max-width:fit-content;max-width:-moz-fit-content}@media only screen and (max-width:360px){.toastify-left,.toastify-right{margin-left:auto;margin-right:auto;left:0;right:0;max-width:fit-content}}`\r\n","import { windowId } from './keys'\r\nimport { Toastify, minifiedCss } from '../shared/toast.js'\r\nimport { deltaFn } from 'src/shared/utils'\r\n\r\nexport const stylesContainer =\r\n  document.getElementById(windowId) ?? document.createElement('div')\r\nstylesContainer.id = windowId\r\ndocument.body.appendChild(stylesContainer)\r\n\r\nconst levels = {\r\n  log: {\r\n    background: 'linear-gradient(to right, #292d3e, #31364a)',\r\n    'box-shadow': '0 3px 6px -1px #0000001f, 0 10px 36px -4px #4d60e84d',\r\n    border: '1px dotted #e3e4e229',\r\n  },\r\n  error: {\r\n    background: 'linear-gradient(to right, #ff4757, #6e1e38)',\r\n    'box-shadow': '0 3px 6px -1px #ff475796, 0 10px 36px -4px #a944424d',\r\n    border: '1px dotted #ff4757',\r\n  },\r\n  warn: {\r\n    background: 'linear-gradient(to right, #8a6d3b, #7a5b32)',\r\n    'box-shadow': '0 3px 6px -1px #8a6d3b70, 0 10px 36px -4px #8a6d3b4d',\r\n    border: '1px dotted #e3e4e229',\r\n  },\r\n  // success: {\r\n  //   background: 'linear-gradient(to right, #3c763d, #356635)',\r\n  //   'box-shadow': '0 3px 6px -1px #509d51b3, 0 10px 36px -4px #3c763d9c',\r\n  //   border: '1px dotted #e3e4e229',\r\n  // },\r\n} as const\r\n\r\n// Experiment with Proxy\r\nexport const toastConsole = new Proxy(\r\n  <Record<keyof typeof levels, Fn>>{}, // dangerous type casting\r\n  {\r\n    get(target, level: keyof typeof levels): Fn {\r\n      if (!(level in levels)) {\r\n        throw new Error('invalid console level')\r\n      }\r\n      return (message, objects, options = {}) => {\r\n        const print = 'Concise Syntax ' + level + ': ' + message\r\n        if (level == 'log') {\r\n          console.groupCollapsed(print, objects ?? {})\r\n          console.trace() // hidden in collapsed group\r\n          console.groupEnd()\r\n        } else if (level == 'warn') {\r\n          console.group('\\x1b[33m\\x1b[40m', `\\u26a0 ${print}`, objects ?? {})\r\n          console.trace()\r\n          console.groupEnd()\r\n        } else {\r\n          console.group('\\x1b[31m\\x1b[40m', `\\u26D4 ${print}`, objects ?? {})\r\n          console.trace()\r\n          console.groupEnd()\r\n        }\r\n        // FIXME: accommodate to the user's theme\r\n        const toastStyle = createStyles('toast')\r\n        toastStyle.styleIt(minifiedCss)\r\n        // FIXME: find a way to pass data to the actual vscode extension\r\n        const toast = new Toastify({\r\n          duration: 500_000,\r\n          close: true,\r\n          gravity: 'bottom',\r\n          position: 'left',\r\n          stopOnFocus: true,\r\n          style: levels[level],\r\n          text: message,\r\n          ...options,\r\n        })\r\n        // FIXME: find a way to trigger the actual vscode extension toast system\r\n        toast.showToast()\r\n      }\r\n    },\r\n  }\r\n)\r\ntype ToastOptions = {\r\n  onClick: (e: MouseEvent) => void\r\n  callback: () => void\r\n}\r\ntype Fn = (\r\n  message: string,\r\n  objects?: any,\r\n  options?: Partial<ToastOptions>\r\n) => void\r\n\r\nexport function createStyles(name: string) {\r\n  const id = windowId + '.' + name\r\n  const style =\r\n    stylesContainer.querySelector(`[id=\"${id}\"]`) ??\r\n    document.createElement('style')\r\n  style.id = id\r\n  stylesContainer.appendChild(style)\r\n\r\n  return {\r\n    element: style,\r\n    styleIt: (text: string) => styleIt(style, text),\r\n    dispose() {\r\n      style.textContent = ''\r\n    },\r\n  }\r\n}\r\n\r\nexport function styleIt(style: Element, text: string) {\r\n  return (style.textContent = text\r\n    .replace(/\\r|\\n/g, '')\r\n    .replaceAll(/\\t+/g, '\\n'))\r\n}\r\n\r\nexport type MutationOptions = {\r\n  added(node: Node): void\r\n  removed(node: Node): void\r\n  options: MutationObserverInit\r\n  target(): HTMLElement\r\n}\r\nexport function createMutation(props: MutationOptions) {\r\n  const observer = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      mutation.addedNodes.forEach(props.added)\r\n      mutation.removedNodes.forEach(props.removed)\r\n    }\r\n  })\r\n\r\n  return {\r\n    observe() {\r\n      // const target = props.target()\r\n      // props.added(target)\r\n      observer.observe(props.target(), props.options)\r\n    },\r\n    disconnect() {\r\n      // props.removed(props.target())\r\n      observer.disconnect()\r\n    },\r\n  }\r\n}\r\ntype MatchMutationOptions = {\r\n  added(node: HTMLElement): void\r\n  removed(node: HTMLElement): void\r\n  // filter(node: Node): boolean\r\n  options: MutationObserverInit\r\n  target(): HTMLElement\r\n}\r\n\r\nexport function specialChildrenMutation(props: MatchMutationOptions) {\r\n  const observer = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      for (const node of mutation.addedNodes) {\r\n        // if (props.filter(node)) {\r\n        props.added(node as any)\r\n        // }\r\n      }\r\n      for (const node of mutation.removedNodes) {\r\n        // if (props.filter(node)) {\r\n        props.removed(node as any)\r\n        // }\r\n      }\r\n    }\r\n  })\r\n\r\n  return {\r\n    stop() {\r\n      observer.takeRecords()\r\n      observer.disconnect()\r\n    },\r\n    plug(mapChildren?: (children: NodeListOf<ChildNode>) => ChildNode[]) {\r\n      const target = props.target()\r\n\r\n      ;(mapChildren?.(target.childNodes) ?? target.childNodes).forEach(\r\n        props.added as any\r\n      )\r\n      observer.observe(target, props.options)\r\n    },\r\n    unplug() {\r\n      const target = props.target()\r\n\r\n      target.childNodes.forEach(props.removed as any)\r\n      observer.disconnect()\r\n    },\r\n  }\r\n}\r\n\r\nexport function createStackedMutation<T>(options: {\r\n  added(node: Node): void\r\n  removed(node: Node): void\r\n  options: MutationObserverInit\r\n}) {\r\n  function add(node: Node) {\r\n    options.added(node)\r\n  }\r\n  function remove(node: Node) {\r\n    options.removed(node)\r\n  }\r\n\r\n  const observer = new MutationObserver((mutations) => {\r\n    mutations.forEach((mutation) => {\r\n      mutation.addedNodes.forEach(add)\r\n      mutation.removedNodes.forEach(remove)\r\n    })\r\n  })\r\n\r\n  return {\r\n    track(target: HTMLElement) {\r\n      add(target)\r\n      observer.observe(target, options.options)\r\n    },\r\n    untrack(target: HTMLElement) {\r\n      remove(target)\r\n      observer.disconnect()\r\n    },\r\n  }\r\n}\r\n\r\ntype D = string | undefined\r\n\r\nexport function createAttributeArrayMutation(props: {\r\n  watchAttribute: string[]\r\n  children?: boolean\r\n  change: (newAttributes: D[], oldAttributes: D[], node: HTMLElement) => void\r\n  target(): HTMLElement\r\n}) {\r\n  let previousData: D[] = []\r\n  const bridgeAttribute = (target: any): D[] =>\r\n    props.watchAttribute.map((a) => target?.getAttribute?.(a))\r\n\r\n  function change(target: HTMLElement) {\r\n    const newData = bridgeAttribute(target)\r\n    if (newData.every((d, i) => d === previousData[i])) return\r\n    const oldAttributes = [...previousData]\r\n    previousData = newData\r\n\r\n    props.change(newData, oldAttributes, target)\r\n  }\r\n  const observer = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      change(mutation.target as HTMLElement)\r\n    }\r\n  })\r\n  const options = {\r\n    attributes: true,\r\n    subtree: props.children,\r\n    // childList: props.children,\r\n    attributeFilter: props.watchAttribute,\r\n  }\r\n  return {\r\n    plug() {\r\n      const target = props.target()\r\n      change(target)\r\n      observer.observe(target, options)\r\n    },\r\n    stop() {\r\n      observer.takeRecords()\r\n      observer.disconnect()\r\n    },\r\n    disconnect() {\r\n      // change(props.target())\r\n\r\n      observer.disconnect()\r\n    },\r\n  }\r\n}\r\n\r\n// TODO: merge common ancestors with each invocation\r\n// TODO: test if this is more \"performant\" or just mental gymnastics\r\nexport function watchForRemoval(targetElement: Element, callback: Function) {\r\n  let done = false\r\n  let stack: Node[] = []\r\n  const rootObserver = new MutationObserver((mutationsList) => {\r\n    mutationsList.forEach((mutation) => {\r\n      if (\r\n        done ||\r\n        !stack.includes(mutation.target) ||\r\n        !mutation.removedNodes.length\r\n      )\r\n        return\r\n\r\n      const nodes = Array.from(mutation.removedNodes)\r\n      // console.log(mutation.target)\r\n\r\n      // direct match\r\n      if (\r\n        nodes.indexOf(targetElement) > -1 ||\r\n        // parent match\r\n        nodes.some((parent) => parent.contains(targetElement))\r\n      ) {\r\n        console.log('removed', targetElement, stack)\r\n        dispose()\r\n        callback()\r\n        return\r\n      }\r\n    })\r\n  })\r\n\r\n  function REC_ObserverAncestors(element: Element) {\r\n    if (!element.parentElement || element.parentElement === document.body) {\r\n      return\r\n    }\r\n    stack.push(element.parentElement)\r\n    rootObserver.observe(element.parentElement, { childList: true })\r\n    REC_ObserverAncestors(element.parentElement)\r\n  }\r\n\r\n  // Start observing ancestor hierarchy\r\n  REC_ObserverAncestors(targetElement)\r\n\r\n  function dispose() {\r\n    done = true\r\n    stack = []\r\n    rootObserver.takeRecords()\r\n    rootObserver.disconnect()\r\n  }\r\n  return dispose\r\n}\r\n\r\n/**\r\n * Die because of abstractions...\r\n */\r\nexport function innerChildrenMutation<T>(options: {\r\n  parent: HTMLElement\r\n  dispose?(): void\r\n  validate: (node: HTMLElement, cleanUp?: Function) => T\r\n  added(validPayload: NonNullable<T>): () => void\r\n  removed(node: HTMLElement, consume: Function): (() => void) | void\r\n}) {\r\n  let cleanUp = deltaFn()\r\n  const observer = specialChildrenMutation({\r\n    target: () => options.parent,\r\n    options: { childList: true },\r\n    added(node) {\r\n      const data = options.validate(node, cleanUp.fn)\r\n      if (!data) return\r\n      const res = options.added(data)\r\n      if (res) {\r\n        // FIXME: this might be a .consume() edge case\r\n        cleanUp.fn = res\r\n      }\r\n    },\r\n    removed(node) {\r\n      options.removed(node, cleanUp.consume)\r\n    },\r\n  })\r\n\r\n  observer.plug()\r\n  return () => {\r\n    options.dispose?.()\r\n    cleanUp.consume()\r\n    observer.stop()\r\n  }\r\n}\r\n// avoid circular dependency\r\nfunction e(unknown: any): unknown is HTMLElement {\r\n  return unknown instanceof HTMLElement\r\n}\r\n","import { deltaFn } from 'src/shared/utils'\r\nimport { toastConsole, watchForRemoval } from './shared'\r\n\r\nexport type LifecycleProps<T> = {\r\n  activate(dom: T): void | (() => void)\r\n  dom(): T & { check(): boolean; watchForRemoval: HTMLElement }\r\n  dispose?: () => void\r\n}\r\n\r\n/**\r\n * @description The **activate** function is called when the dom **check** passes. Then if the **item** is removed from the dom, the **dispose** function is called.\r\n *\r\n * Then it will try to **reload** the lifecycle.\r\n */\r\nexport function lifecycle<T>(props: LifecycleProps<T>) {\r\n  let running = false\r\n  let tryFn = createTryFunction({ fallback: clean })\r\n  let interval: NodeJS.Timeout\r\n  let disposeObserver = deltaFn()\r\n  let disposeActivate = deltaFn()\r\n\r\n  function patch() {\r\n    const dom = props.dom()\r\n    if (running || !dom.check()) return\r\n    running = true\r\n    clean()\r\n\r\n    tryFn(() => {\r\n      disposeObserver.fn = watchForRemoval(dom.watchForRemoval, reload)\r\n      disposeActivate.fn = props.activate(dom)!\r\n    }, 'Lifecycle crashed unexpectedly when activating')\r\n  }\r\n  function dispose() {\r\n    clean()\r\n\r\n    tryFn(() => {\r\n      disposeActivate.consume()\r\n      disposeObserver.consume()\r\n\r\n      props.dispose?.()\r\n    }, 'Lifecycle crashed unexpectedly when disposing')\r\n    running = false\r\n  }\r\n  function reload(delay = 5000) {\r\n    dispose()\r\n    interval = setInterval(patch, delay)\r\n  }\r\n  function clean() {\r\n    clearInterval(interval)\r\n  }\r\n\r\n  return {\r\n    get running() {\r\n      return running\r\n    },\r\n    activate(delay = 5000) {\r\n      if (\r\n        tryFn.guard('Lifecycle already crashed therefore not activating again')\r\n      ) {\r\n        return\r\n      }\r\n\r\n      reload(delay)\r\n    },\r\n    dispose() {\r\n      if (\r\n        tryFn.guard('Lifecycle already crashed therefore not disposing again')\r\n      ) {\r\n        return\r\n      }\r\n\r\n      dispose()\r\n      clean()\r\n    },\r\n  }\r\n}\r\n\r\ntype Guard = Partial<{ fallback: Function; message: string }>\r\n/**\r\n * TODO: This gotta be a pattern or something\r\n */\r\nexport function createTryFunction(guard?: Guard) {\r\n  let crashed = false\r\n\r\n  function tryFunction(fn: Function, message: string) {\r\n    if (crashed) return\r\n\r\n    try {\r\n      fn()\r\n    } catch (error) {\r\n      crashed = true\r\n      toastConsole.error('Fatal - ' + message, { error })\r\n    }\r\n  }\r\n  // assign a getter to the tryFunction\r\n  Object.defineProperty(tryFunction, 'crashed', {\r\n    get() {\r\n      return crashed\r\n    },\r\n  })\r\n  // assign a guard function to the tryFunction\r\n  tryFunction.guard = (action: Function | string) => {\r\n    if (crashed) {\r\n      // just pass a function bruh...\r\n      const fallback = action ?? guard?.fallback\r\n      if (typeof fallback === 'function') {\r\n        fallback()\r\n      }\r\n      const message = action ?? guard?.message\r\n      if (typeof message === 'string') {\r\n        console.warn(message)\r\n      }\r\n    }\r\n    return crashed\r\n  }\r\n  return tryFunction as typeof tryFunction & {\r\n    get crashed(): boolean\r\n  }\r\n}\r\n","import { bridgeBetweenVscodeExtension } from './keys'\r\nimport { lifecycle } from './lifecycle'\r\nimport { createAttributeArrayMutation, innerChildrenMutation } from './shared'\r\nimport type { IState, ICalibrate } from '../shared/state'\r\nimport type { stateObservable, calibrateObservable } from './index'\r\n\r\n/**\r\n * @description When the vscode extension changes the \"bridge attribute\" apply custom styles\r\n *\r\n * Take a look at: regexToDomToCss.ts to see how the styles are generated\r\n */\r\nexport function createSyntaxLifecycle(\r\n  observable: typeof stateObservable | typeof calibrateObservable,\r\n  state: typeof IState | typeof ICalibrate\r\n) {\r\n  return lifecycle<{ watchForRemoval: H }>({\r\n    dom() {\r\n      const statusBar = document.querySelector('footer .right-items') as H\r\n      return {\r\n        watchForRemoval: statusBar,\r\n        check() {\r\n          return !!document.contains(statusBar?.parentNode)\r\n        },\r\n      }\r\n    },\r\n    activate(DOM) {\r\n      // FIXME: share a single mutation\r\n      return innerChildrenMutation({\r\n        parent: DOM.watchForRemoval,\r\n        validate(node, busy) {\r\n          if (busy) return\r\n          const item = DOM.watchForRemoval?.querySelector(state.selector) as H\r\n          const icon = item?.querySelector('.codicon') as H\r\n          if (!item || !icon) return\r\n          return { icon, item }\r\n        },\r\n        added(dom) {\r\n          const attributeObserver = createAttributeArrayMutation({\r\n            target: () => dom.item,\r\n            watchAttribute: [bridgeBetweenVscodeExtension],\r\n            change([bridge]) {\r\n              const delta = state.decode(bridge)\r\n              if (!delta || observable.value === delta) return\r\n              observable.value = delta\r\n            },\r\n          })\r\n\r\n          attributeObserver.plug()\r\n          return attributeObserver.stop\r\n        },\r\n        removed(node, consume) {\r\n          if (node.matches(state.selector)) {\r\n            consume()\r\n          }\r\n        },\r\n      })\r\n    },\r\n  })\r\n}\r\n\r\ntype H = HTMLElement\r\n","import {\r\n  currentSelector,\r\n  editorSelector,\r\n  overlaySelector,\r\n  selectedSelector,\r\n  splitViewContainerSelector,\r\n} from './keys'\r\nimport { stylesContainer, toastConsole } from './shared'\r\n\r\nexport function clear(label?: string) {\r\n  stylesContainer\r\n    .querySelectorAll(label ? `[aria-label=\"${label}\"]` : '[aria-label]')\r\n    .forEach((style) => style.remove())\r\n}\r\nexport const styles = {\r\n  clear(label: string) {\r\n    clear(label)\r\n  },\r\n  clearOverlays() {\r\n    clear()\r\n  },\r\n  getOrCreateLabeledStyle(label: string, selector: string) {\r\n    let style = stylesContainer.querySelector(\r\n      `[aria-label=\"${label}\"][selector=\"${selector}\"]`\r\n    ) as HTMLElement\r\n    if (!style || !stylesContainer.contains(style)) {\r\n      style = document.createElement('style')\r\n      style.setAttribute('aria-label', label)\r\n      style.setAttribute('selector', selector)\r\n      stylesContainer.appendChild(style)\r\n    }\r\n    return style\r\n  },\r\n  swapLabeledStyle(oldLabel: string, newLabel: string) {\r\n    const styles = stylesContainer.querySelectorAll(\r\n      `[aria-label=\"${oldLabel}\"]`\r\n    )\r\n    styles.forEach((style) => {\r\n      style.setAttribute('aria-label', newLabel)\r\n      style.textContent = style.textContent?.replace(oldLabel, newLabel) ?? ''\r\n    })\r\n  },\r\n}\r\n\r\nexport type Selected = {\r\n  node: Node\r\n  selector: string\r\n  add: boolean\r\n  set: Set<number>\r\n  color: string\r\n  label: string\r\n}\r\nexport function tryGetAttribute(\r\n  line: HTMLElement,\r\n  attribute: string\r\n): string | undefined {\r\n  // @ts-ignore\r\n  return (line.editor =\r\n    line.closest(`[${attribute}]`)?.getAttribute(attribute) ??\r\n    // @ts-ignore\r\n    line.editor)\r\n}\r\n\r\nexport function findScopeElements(view: HTMLElement) {\r\n  type H = HTMLElement | null\r\n  const container = view.querySelector(':scope > div > .editor-container') as H\r\n  const nested = view.querySelector(\r\n    ':scope > div > div > div > .split-view-container'\r\n  ) as H\r\n  const editor = container?.querySelector(editorSelector) as H\r\n  const overlay = editor?.querySelector(overlaySelector) as H\r\n  const anyLine = overlay?.querySelector(\r\n    `${selectedSelector}, ${currentSelector}`\r\n  ) as H\r\n  return { nested, container, editor, overlay, anyLine }\r\n}\r\nfunction lookup(node: Node | null, up: number): Node {\r\n  return Array(up)\r\n    .fill(0)\r\n    .reduce((acc, _) => acc?.parentElement, node)\r\n}\r\nexport function lookupTo(\r\n  node: Node | null,\r\n  up: number,\r\n  to: Node\r\n): node is HTMLElement {\r\n  return lookup(node, up) === to\r\n}\r\n\r\nexport function e(el: unknown): el is HTMLElement {\r\n  return el instanceof HTMLElement\r\n}\r\n\r\nexport function consumeStack(\r\n  stack: Map<HTMLElement, Function>,\r\n  key: HTMLElement\r\n) {\r\n  // if (stack.has(key)) { // it's better if it fails so we can fix it\r\n  stack.get(key)?.()\r\n  stack.delete(key)\r\n  // }\r\n}\r\n\r\nexport function guardStack(\r\n  stack: Map<HTMLElement, Function>,\r\n  key: HTMLElement,\r\n  cleanup: Function\r\n) {\r\n  if (stack.has(key)) {\r\n    // TODO: figure out why this is happening\r\n    // toastConsole.warn('Highlight lifecycle stack already has this key', {\r\n    //   stack,\r\n    //   key,\r\n    // })\r\n    consumeStack(stack, key)\r\n  }\r\n  stack.set(key, cleanup)\r\n}\r\n\r\nexport function parseTopStyle(node: HTMLElement) {\r\n  return Number(node.style?.top.match(/\\d+/)?.[0])\r\n}\r\n\r\nexport function validateAddedView(node: Node, rebootCleanup?: Function) {\r\n  if (rebootCleanup) {\r\n    toastConsole.error('Reboot cleanup already exists', {\r\n      rebootCleanup,\r\n    })\r\n    return\r\n  }\r\n\r\n  type H = HTMLElement | undefined\r\n  if (!e(node)) {\r\n    toastConsole.warn('Reboot added node is not HTMLElement', { node })\r\n    return\r\n  }\r\n  const rootContainer = node.querySelector(splitViewContainerSelector) as H\r\n  if (!rootContainer) {\r\n    toastConsole.warn('Reboot rootContainer not found with selector', {\r\n      node,\r\n      splitViewContainerSelector,\r\n    })\r\n    return\r\n  }\r\n\r\n  // root.plug() special case, the first view never gets removed * sigh *\r\n  const [firstView, ...restViews] = rootContainer.childNodes\r\n  if (!e(firstView)) {\r\n    toastConsole.warn('Reboot first view element is not HTMLElement', {\r\n      rootContainer,\r\n      firstView,\r\n    })\r\n    return\r\n  }\r\n  let container = findScopeElements(firstView).container\r\n  if (!container) {\r\n    // FIXME: this is panic scenario\r\n    container = firstView.querySelector('.editor-container') as any\r\n    if (!container) {\r\n      // prettier-ignore\r\n      toastConsole.warn('Reboot container not found even without :scope selector', {\r\n\t\t\t\tfirstView,\r\n\t\t\t\tcontainer,\r\n\t\t\t})\r\n    }\r\n  }\r\n\r\n  if (container) {\r\n    return {\r\n      rootContainer,\r\n      firstView,\r\n      container,\r\n      restViews,\r\n    }\r\n  } else {\r\n    toastConsole.error('Reboot first view container not found', {\r\n      rootContainer,\r\n      firstView,\r\n    })\r\n  }\r\n}\r\n","import {\r\n  currentSelector,\r\n  highlightSelector,\r\n  idSelector,\r\n  linesSelector,\r\n  overlaySelector,\r\n  selectedSelector,\r\n  splitViewContainerSelector,\r\n} from './keys'\r\nimport { lifecycle } from './lifecycle'\r\nimport {\r\n  createAttributeArrayMutation,\r\n  specialChildrenMutation,\r\n  createMutation,\r\n  styleIt,\r\n  innerChildrenMutation,\r\n  toastConsole,\r\n} from './shared'\r\nimport {\r\n  Selected,\r\n  consumeStack,\r\n  e,\r\n  findScopeElements,\r\n  guardStack,\r\n  parseTopStyle,\r\n  styles,\r\n  validateAddedView,\r\n} from './utils'\r\nimport type { editorObservable } from './index'\r\n\r\n/**\r\n * @description Change color of highlighted or selected lines\r\n *\r\n * Take a look at the {createHighlight} function to see how the styles are generated\r\n */\r\nexport function createHighlightLifeCycle(\r\n  _editorObservable: typeof editorObservable\r\n) {\r\n  return lifecycle({\r\n    // prettier-ignore\r\n    dom() {\r\n      const gridRoot = document.querySelector('#workbench\\\\.parts\\\\.editor > div.content > div > div') as H\r\n      const root = gridRoot.querySelector(':scope > div > div > div.monaco-scrollable-element > ' + splitViewContainerSelector) as H\r\n      const editor = root?.querySelector(idSelector) as H\r\n      const overlays = editor?.querySelector(highlightSelector)?.parentElement as H\r\n      return {\r\n        check: () => !!overlays,\r\n        watchForRemoval: gridRoot,\r\n      }\r\n    },\r\n    activate(DOM) {\r\n      /**\r\n       * - split-view-container\r\n       * \t\t- split-view-view -> Recursion\r\n       * \t\t\t- editor-container\r\n       * \t\t\t\t- editor-instance\r\n       * \t\t\t\t\t- view-overlays\r\n       * \t\t\t\t\t\t\t- selected-text\r\n       * \t\t\t\t\t\t\t- current-line\r\n       */\r\n      const structure = createStackStructure(\r\n        DOM.watchForRemoval,\r\n        _editorObservable\r\n      )\r\n\r\n      return innerChildrenMutation({\r\n        parent: DOM.watchForRemoval,\r\n        dispose: structure.clearStacks,\r\n        validate: validateAddedView,\r\n        added(res) {\r\n          const recursiveViewTracker = structure.REC_EditorOverlayTracker(\r\n            res.rootContainer\r\n          )\r\n          // This is a special case, the first view never gets removed\r\n          const firsContainerTracker = specialChildrenMutation({\r\n            target: () => res.container,\r\n            options: { childList: true },\r\n            added() {\r\n              structure.REC_added(res.firstView)\r\n            },\r\n            removed() {\r\n              structure.bruteForceRemove(res.firstView)\r\n            },\r\n          })\r\n\r\n          recursiveViewTracker.plug(() => res.restViews)\r\n          firsContainerTracker.plug()\r\n          return () => {\r\n            recursiveViewTracker.stop()\r\n            firsContainerTracker.stop()\r\n          }\r\n        },\r\n        removed(node, consume) {\r\n          consume()\r\n        },\r\n      })\r\n    },\r\n    dispose() {\r\n      styles.clearOverlays()\r\n    },\r\n  })\r\n}\r\n\r\nfunction createHighlight({ node, selector, add, set, label, color }: Selected) {\r\n  if (!e(node) || !node.querySelector(selector)) return\r\n  const top = parseTopStyle(node)\r\n  if (\r\n    isNaN(top) ||\r\n    set.has(top) === add ||\r\n    (!add &&\r\n      // FIXME: figure out how to overcome vscode rapid dom swap at viewLayers.ts _finishRenderingInvalidLines\r\n      document.querySelector(\r\n        `[aria-label=\"${label}\"]` +\r\n          highlightSelector +\r\n          `>[style*=\"${top}\"]>` +\r\n          selector\r\n      ))\r\n  ) {\r\n    return\r\n  }\r\n\r\n  // funny code\r\n  set[add ? 'add' : 'delete'](top)\r\n\r\n  const lines = Array.from(set)\r\n    .reduce((acc, top) => acc + `[style*=\"${top}\"],`, '')\r\n    .slice(0, -1)\r\n\r\n  styleIt(\r\n    styles.getOrCreateLabeledStyle(label, selector),\r\n    `[aria-label=\"${label}\"]${linesSelector} :is(${lines}) {\r\n\t\t\t\t--r: ${color};\r\n\t\t}`\r\n  )\r\n\r\n  return true\r\n}\r\n\r\nfunction editorOverlayLifecycle(\r\n  editor: HTMLElement,\r\n  _overlay: HTMLElement,\r\n  foundEditor: () => void\r\n) {\r\n  // lookup state\r\n  let editorLabel = editor.getAttribute('aria-label') as string | undefined\r\n  // when changing the textDocument the editor outlives the overlay\r\n  let deltaOverlay = _overlay as HTMLElement // | undefined\r\n\r\n  const EditorLanguageTracker = createAttributeArrayMutation({\r\n    target: () => editor,\r\n    watchAttribute: ['data-mode-id', 'aria-label'],\r\n    change([language, label], [, oldLabel]) {\r\n      editorLabel = label\r\n\r\n      if (!language || !label) {\r\n        if (oldLabel && label != oldLabel) {\r\n          styles.clear(oldLabel)\r\n        }\r\n        return\r\n      }\r\n\r\n      OverlayLineTracker.disconnect()\r\n\r\n      // FIXME: this is a panic scenario, should throw and exception or execute a failure callback\r\n      if (!editor.contains(deltaOverlay!)) {\r\n        // also if it fails to query the overlay, use the last one because a undefined overlay will cause a crash\r\n        deltaOverlay = editor?.querySelector<H>(overlaySelector) ?? deltaOverlay\r\n      }\r\n\r\n      if (label.match(/(\\.tsx$)|(\\.tsx, )/)) {\r\n        if (language === 'typescriptreact') {\r\n          OverlayLineTracker.observe()\r\n          bruteForceLayoutShift(foundEditor)\r\n        }\r\n        if (oldLabel && label != oldLabel) {\r\n          toastConsole.log('look! this gets executed...', oldLabel)\r\n        }\r\n      } else {\r\n        styles.clear(label)\r\n      }\r\n    },\r\n  })\r\n  function mount() {\r\n    selectedLines.clear()\r\n    currentLines.clear()\r\n    deltaOverlay.childNodes.forEach((node) => highlightStyles(node, true)) // if you restart vscode, there might be selected lines already\r\n  }\r\n\r\n  // lookup state\r\n  let selectedLines = new Set<number>()\r\n  let currentLines = new Set<number>()\r\n\r\n  const OverlayLineTracker = createMutation({\r\n    target: () => deltaOverlay,\r\n    options: {\r\n      childList: true,\r\n    },\r\n    added(node) {\r\n      highlightStyles(node, true)\r\n    },\r\n    removed(node) {\r\n      highlightStyles(node, false)\r\n    },\r\n  })\r\n\r\n  function highlightStyles(node: Node, add: boolean) {\r\n    if (!editorLabel) return\r\n    const pre = { node, add, label: editorLabel }\r\n    createHighlight({\r\n      selector: selectedSelector,\r\n      color: 'orange',\r\n      set: selectedLines,\r\n      ...pre,\r\n    }) ||\r\n      createHighlight({\r\n        selector: currentSelector,\r\n        color: 'brown',\r\n        set: currentLines,\r\n        ...pre,\r\n      })\r\n  }\r\n\r\n  // FIXME: find a better way to handle selected lines flickering and layout shifts\r\n  // issue: the top style shifts right before the last frame\r\n  let layoutShift: any\r\n  let tries = 0\r\n  const limit = 5\r\n  const lineTracker = (cb: Function) => {\r\n    tries += 1\r\n    if (tries > limit) {\r\n      cb()\r\n      clearInterval(layoutShift)\r\n      return\r\n    }\r\n    const line = deltaOverlay.querySelector(selectedSelector) as H\r\n    if (line && !isNaN(parseTopStyle(line))) {\r\n      mount()\r\n    }\r\n  }\r\n  function bruteForceLayoutShift(cb: Function) {\r\n    tries = 0\r\n    clearInterval(layoutShift)\r\n    layoutShift = setInterval(() => lineTracker(cb), 100)\r\n  }\r\n\r\n  EditorLanguageTracker.plug()\r\n\r\n  return function dispose() {\r\n    clearInterval(layoutShift)\r\n    if (editorLabel) {\r\n      styles.clear(editorLabel)\r\n    } else {\r\n      // FIXME: this is like leaking information that can't be clean up later\r\n      toastConsole.error('editorLabel is undefined')\r\n    }\r\n    EditorLanguageTracker.disconnect()\r\n    OverlayLineTracker.disconnect()\r\n  }\r\n}\r\n\r\nfunction createStackStructure(\r\n  watchForRemoval: HTMLElement,\r\n  _editorObservable: typeof editorObservable\r\n) {\r\n  let recStack = new Map<HTMLElement, Function>()\r\n  let editorStack = new Map<HTMLElement, Function>()\r\n  let treeStack = new Map<HTMLElement, Function>()\r\n  const REC_EditorOverlayTracker = (target: HTMLElement) =>\r\n    specialChildrenMutation({\r\n      target: () => target,\r\n      options: {\r\n        childList: true,\r\n      },\r\n      added: REC_added,\r\n      removed: bruteForceRemove,\r\n    })\r\n\r\n  function clearStacks(condition?: (keyNode: HTMLElement) => boolean) {\r\n    for (const stack of [recStack, editorStack, treeStack]) {\r\n      for (const [keyNode] of stack) {\r\n        if (condition && !condition(keyNode)) continue\r\n\r\n        consumeStack(stack, keyNode)\r\n      }\r\n    }\r\n  }\r\n  function awkwardStack(elements: ReturnType<typeof findScopeElements>) {\r\n    const { overlay, editor } = elements\r\n    if (overlay && editor && !editorStack.has(editor)) {\r\n      // TODO: get me out of here\r\n      const foundEditor = () => {\r\n        if (!watchForRemoval.contains(editor)) {\r\n          toastConsole.error('Editor not found _editorObservable')\r\n          return\r\n        }\r\n        _editorObservable.value = editor.getAttribute('aria-label')!\r\n      }\r\n      // toastConsole.log('awkwardStack')\r\n      editorStack.set(\r\n        editor,\r\n        editorOverlayLifecycle(editor, overlay, foundEditor)\r\n      )\r\n      return true\r\n    }\r\n  }\r\n  function REC_added(splitViewView: HTMLElement) {\r\n    // toastConsole.log('REC_added')\r\n    const elements = findScopeElements(splitViewView)\r\n\r\n    if (elements.nested) {\r\n      const rec = REC_EditorOverlayTracker(elements.nested)\r\n      rec.plug()\r\n\r\n      guardStack(recStack, splitViewView, rec.stop) // don't \"unplug\" because the unwinding will cause a stack overflow plus the \"removed\" method is currently brute force\r\n    } else if (awkwardStack(elements)) {\r\n      // noop\r\n    } else if (!elements.overlay) {\r\n      const treeTracker = specialChildrenMutation({\r\n        target: () => splitViewView,\r\n        options: {\r\n          childList: true,\r\n          subtree: true,\r\n        },\r\n        // FIXME: this should handle the mutation callback instead of each added node\r\n        added() {\r\n          const elements = findScopeElements(splitViewView)\r\n          if (awkwardStack(elements)) {\r\n            treeTracker.stop()\r\n            // TODO: maybe both recStack and treeStack could be cleared here without instead of brute force\r\n          }\r\n        },\r\n        // TODO: this is not needed\r\n        removed() {},\r\n      })\r\n\r\n      treeTracker.plug()\r\n      guardStack(treeStack, splitViewView, treeTracker.stop) // don't \"unplug\" because the unwinding will cause a stack overflow plus the \"removed\" method is currently brute force\r\n    }\r\n  }\r\n  function bruteForceRemove(splitViewView: HTMLElement) {\r\n    // FIXME: this should be handled by each cycle, there is an unhandled cleanup\r\n    clearStacks((keyNode) => !watchForRemoval.contains(keyNode))\r\n  }\r\n\r\n  return {\r\n    REC_EditorOverlayTracker,\r\n    clearStacks,\r\n    REC_added,\r\n    bruteForceRemove,\r\n  }\r\n}\r\ntype H = HTMLElement\r\n","import { extensionId } from '../workbench/keys'\r\n\r\nexport const stateIcon = 'symbol-keyword'\r\nexport const state = {\r\n  active: 'active',\r\n  inactive: 'inactive',\r\n  stale: 'stale',\r\n  disposed: 'disposed',\r\n  error: 'error',\r\n} as const\r\nexport type State = (typeof state)[keyof typeof state]\r\n/**\r\n * Exploit the fact that vscode will render strings to the DOM\r\n */\r\nexport const IState = {\r\n  selector: iconSelector(stateIcon),\r\n  encode(state: State) {\r\n    return `Concise Syntax: ${state}` as const\r\n  },\r\n  /**\r\n   * VSCode will reinterpret the string: \"<?icon>  <extensionName>, <?IState.encode>\"\r\n   * @param string\r\n   * @returns\r\n   */\r\n  decode(string?: string) {\r\n    return Object.values(state)\r\n      .reverse()\r\n      .find((state) => string?.includes(state))\r\n  },\r\n}\r\n\r\nexport const calibrateIcon = 'go-to-file'\r\nexport const calibrationFileName = 'syntax.tsx'\r\nexport const calibrate = {\r\n  opening: 'opening',\r\n  opened: 'opened',\r\n  closed: 'closed',\r\n  error: 'error',\r\n} as const\r\n/**\r\n * standBy     nothing   / bootUp\r\n * requesting  click     / opening\r\n * loaded      dom/click / opened\r\n * windowState nothing   / closed\r\n *\r\n * noting/bootUp > click > opening > opened > dom/click > closed > standBy\r\n */\r\nexport type Calibrate = (typeof calibrate)[keyof typeof calibrate]\r\n/**\r\n * Exploit the fact that vscode will render strings to the DOM\r\n */\r\nexport const ICalibrate = {\r\n  selector: iconSelector(calibrateIcon),\r\n  encode(state: Calibrate) {\r\n    return `Concise Syntax (calibrate): ${state}` as const\r\n  },\r\n  /**\r\n   * VSCode will reinterpret the string: \"<?icon>  <extensionName>, <?IState.encode>\"\r\n   * @param string\r\n   * @returns\r\n   */\r\n  decode(string?: string) {\r\n    return Object.values(calibrate)\r\n      .reverse()\r\n      .find((state) => string?.includes(state))\r\n  },\r\n}\r\n\r\nfunction iconSelector(icon: string) {\r\n  return `[id=\"${extensionId}\"]:has(.codicon-${icon})` as const\r\n}\r\n","import { linesSelector, customCSS, extensionId } from './keys'\r\nimport { toastConsole } from './shared'\r\n\r\nexport const editorFlags = {\r\n  jsx: {\r\n    flags: {\r\n      jsxTag: null as FlagOr,\r\n      jsxTagUpperCase: null as FlagOr,\r\n      jsxTernaryBrace: null as FlagOr,\r\n      jsxTernaryOtherwise: null as FlagOr,\r\n      vsCodeHiddenTokens: null as FlagOr,\r\n      separator: null as FlagOr,\r\n      beginQuote: null as FlagOr,\r\n      endQuote: null as FlagOr,\r\n    },\r\n    customFlags: {\r\n      singleQuotes: null as string | null,\r\n      jsxTernaryOtherwiseHover: null as string | null,\r\n    },\r\n  },\r\n}\r\n\r\ntype SymbolClass<Payload> = {\r\n  [key: string]:\r\n    | {\r\n        match: RegExp | string\r\n      }\r\n    | ({\r\n        match: RegExp | string\r\n      } & Partial<{\r\n        [condition: string]: (payload: Payload) => HTMLElement | undefined\r\n      }>)\r\n}\r\nconst symbolTable = {\r\n  openTag: {\r\n    match: /<|<\\//,\r\n    lowerCase({ siblings, current }) {\r\n      const tag = siblings[siblings.indexOf(current) + 1]\r\n      if (tag.textContent?.toLowerCase() === tag.textContent) {\r\n        return tag\r\n      }\r\n    },\r\n    upperCase({ siblings, current }) {\r\n      const tag = siblings[siblings.indexOf(current) + 1]\r\n      if (tag.textContent?.match(/^[A-Z]/)) {\r\n        return tag\r\n      }\r\n    },\r\n  },\r\n\r\n  anySpace: { match: /\\s+/ },\r\n\r\n  quotes: {\r\n    match: /\"|'|`/,\r\n    empty({ siblings, current }) {\r\n      const empty = current?.textContent?.match(/\"\"|''|``/)\r\n      if (empty?.[0]) {\r\n        return current\r\n      }\r\n    },\r\n    string({ siblings, current }) {\r\n      const beginQuote = current.textContent\r\n      const string = siblings[siblings.indexOf(current) + 1]\r\n      const end = siblings[siblings.indexOf(current) + 2]\r\n      const endQuote = end?.textContent?.match(this.match)?.[0]\r\n      if (\r\n        beginQuote?.length == 1 &&\r\n        string?.textContent?.length &&\r\n        beginQuote === endQuote\r\n      ) {\r\n        return string\r\n      }\r\n    },\r\n  },\r\n\r\n  // openBracket:/{/, // overloads...\r\n  // tag:/li/, // derived\r\n\r\n  openBrace: { match: /\\(/ }, // single operation + overloads\r\n  colon: { match: /:/ },\r\n  nul: { match: /null/ },\r\n  // undefine: { match: /undefined/ },\r\n} satisfies SymbolClass<{\r\n  siblings: HTMLSpanElement[]\r\n  current: HTMLSpanElement\r\n}>\r\n\r\nconst symbolLineTable = {\r\n  closeTag: {\r\n    match: /(>|\\/>)$/,\r\n    capture({ siblings }) {\r\n      return siblings[siblings.length - 1]\r\n    },\r\n  },\r\n  lastComa: {\r\n    match: /,$/,\r\n    capture({ siblings }) {\r\n      return siblings[siblings.length - 1]\r\n    },\r\n  },\r\n  indentation: {\r\n    match: /}$/, // FIXME: this is bet that if it is closing brace, then there must be indentation\r\n    capture({ siblings }) {\r\n      return siblings[0]\r\n    },\r\n  },\r\n} satisfies SymbolClass<{\r\n  siblings: HTMLSpanElement[]\r\n}>\r\n\r\nfunction parseSymbolColors(lineEditor: HTMLElement) {\r\n  debugger\r\n  let log = {\r\n    line: 0,\r\n    siblings: 0,\r\n    table: 0,\r\n    match: 0,\r\n    condition: 0,\r\n    check: 0,\r\n    color: 0,\r\n    splice: 0,\r\n  }\r\n  const lines = Array.from(lineEditor.querySelectorAll('div>span'))\r\n\r\n  let table: any = structuredClone(symbolTable)\r\n  let tableResult: any = {}\r\n\r\n  let lineTable: any = structuredClone(symbolLineTable)\r\n  let lineTableResult: any = {}\r\n\r\n  // typescript...\r\n  type Table = typeof symbolTable\r\n  type TableKeyUnions = { [K in keyof Table]: { [K2 in keyof Table[K]]: any } }\r\n  type AllKeys<T> = T extends any ? keyof T : never\r\n  type TableKeys = AllKeys<TableKeyUnions>\r\n  type conditionKeys = AllKeys<TableKeyUnions[keyof Table]>\r\n\r\n  parser: for (const line of lines) {\r\n    // log.line++\r\n    const text = line.textContent\r\n    if (!text) continue\r\n\r\n    const siblings = Array.from(line.children) as HTMLElement[]\r\n\r\n    for (let current of siblings) {\r\n      // log.siblings++\r\n      const content = current.textContent\r\n\r\n      for (let key in table) {\r\n        // log.table++\r\n\r\n        const match = content?.match(table[key].match)\r\n        if (!match) continue\r\n        // log.match++\r\n\r\n        tableResult[key] ??= {}\r\n\r\n        for (let conditionKey in table[key]) {\r\n          // log.condition++\r\n\r\n          if (typeof table[key][conditionKey] === 'function') {\r\n            // log.check++\r\n\r\n            const evaluation = table[key][conditionKey]({\r\n              siblings,\r\n              current,\r\n            }) as HTMLElement | undefined\r\n\r\n            if (evaluation) {\r\n              // log.color++\r\n              tableResult[key][conditionKey] = getColor(evaluation)\r\n\r\n              delete table[key][conditionKey]\r\n            }\r\n          }\r\n        }\r\n        if (Object.keys(table[key]).length === 1) {\r\n          // log.splice++\r\n          tableResult[key].match = getColor(current)\r\n          delete table[key]\r\n        }\r\n      }\r\n    }\r\n    for (let key in lineTable) {\r\n      // log.table++\r\n\r\n      const match = text?.match(lineTable[key].match)\r\n      if (!match) continue\r\n      // log.match++\r\n\r\n      lineTableResult[key] ??= {}\r\n\r\n      const capture = lineTable[key]['capture']({\r\n        siblings,\r\n      }) as HTMLElement | undefined\r\n\r\n      if (!capture) {\r\n        continue\r\n      }\r\n      // log.color++\r\n      lineTableResult[key]['match'] = getColor(capture)\r\n\r\n      delete lineTable[key]\r\n    }\r\n  }\r\n  console.log(log)\r\n}\r\nfunction getColor(span: HTMLElement) {\r\n  const color = span.computedStyleMap().get('color')?.toString()\r\n  return { color, span, classList: span.classList }\r\n}\r\n\r\nexport function jsx_parseStyles(\r\n  lineEditor: HTMLElement,\r\n  _editorFlag: EditorFlags\r\n) {\r\n  const editorFlag = structuredClone(_editorFlag)\r\n  const flags = editorFlag.flags\r\n  const customFlags = editorFlag.customFlags\r\n\r\n  if (isDone()) return editorFlag\r\n\r\n  const lines = Array.from(lineEditor.querySelectorAll('div>span'))\r\n\r\n  parser: for (const line of lines) {\r\n    const text = line.textContent\r\n    if (!text) continue\r\n    let anyFlag = false\r\n\r\n    if (\r\n      !flags.jsxTag &&\r\n      text.match(/.+(<\\/(?<jsxTag>.*)?>)$/)?.groups?.jsxTag\r\n    ) {\r\n      const closing = SliceClassList(line, -3)\r\n      if (!closing.okLength) continue\r\n      const [angleBracket, tag, right] = closing.flat()\r\n      if (angleBracket !== right) continue\r\n\r\n      flags.jsxTag = {\r\n        // find the last </tag> and hide it \"tag\" which is the second to last child\r\n        hide: `:has([class=\"${angleBracket}\"]:nth-last-child(3)+.${tag}+.${angleBracket}) :nth-last-child(2)`,\r\n        hover: `.${angleBracket}+.${tag}`,\r\n      }\r\n      flags.vsCodeHiddenTokens = {\r\n        // this is the most common case, you could derive it from other flags\r\n        hide: `>.${angleBracket}`,\r\n        hover: `.${angleBracket}`,\r\n      }\r\n\r\n      anyFlag = true\r\n    } else if (\r\n      // TODO: better abstraction to implement overloads\r\n      !flags.jsxTagUpperCase &&\r\n      text.match(/.+(<\\/(?<jsxTagUpperCase>[A-Z].*)?>)$/)?.groups\r\n        ?.jsxTagUpperCase\r\n    ) {\r\n      const closing = SliceClassList(line, -3)\r\n      if (!closing.okLength) continue\r\n      const [angleBracket, tag, right] = closing.flat()\r\n      if (angleBracket !== right) continue\r\n\r\n      flags.jsxTagUpperCase = {\r\n        // find the last </Tag> and hide it \"tag\" which is the second to last child\r\n        hide: `:has([class=\"${angleBracket}\"]:nth-last-child(3)+.${tag}+.${angleBracket}) :nth-last-child(2)`,\r\n        hover: `.${angleBracket}+.${tag}`,\r\n      }\r\n\r\n      anyFlag = true\r\n    } else if (\r\n      // TODO: find out what else could be affected through experimentation\r\n      !flags.separator &&\r\n      text.match(/(?<separator>,$)/)?.groups?.separator\r\n    ) {\r\n      const closing = SliceClassList(line, -1)\r\n      if (!closing.okLength) continue\r\n      const [terminator] = closing.flat()\r\n\r\n      flags.separator = {\r\n        // find the last , and hide it\r\n        hide: `>.${terminator}:last-child`,\r\n        hover: `.${terminator}`,\r\n      }\r\n\r\n      anyFlag = true\r\n    } else if (\r\n      !flags.jsxTernaryBrace &&\r\n      text.match(/(\\{).+\\?.+?(?<jsxTernaryBrace>\\()$/)?.groups?.jsxTernaryBrace\r\n    ) {\r\n      const closing = SliceClassList(line, -4)\r\n      if (!closing.okLength) continue\r\n      // prettier-ignore\r\n      const [blank, questionMark, blank2, openBrace] = toFlatClassList(closing)\r\n      const selector = `.${blank}+.${questionMark}+.${blank}+.${openBrace}:last-child`\r\n\r\n      flags.jsxTernaryBrace = {\r\n        // find the last open brace in \" ? (\"\r\n        hide: `:has(${selector}) :last-child`,\r\n        hover: selector,\r\n      }\r\n\r\n      anyFlag = true\r\n    } else if (\r\n      !flags.jsxTernaryOtherwise &&\r\n      text.match(/(?<jsxTernaryOtherwise>\\).+?:.+\\})/)?.groups\r\n        ?.jsxTernaryOtherwise\r\n    ) {\r\n      let selector: string\r\n      const closing7 = SliceClassList(line, -7)\r\n      if (closing7.okLength) {\r\n        // prettier-ignore\r\n        const [blank0, closeBrace, blank, colon, blank2, nullIsh,closeBracket] = toFlatClassList(closing7)\r\n        selector = `.${blank0}+.${closeBrace}+.${blank}+.${colon}+.${blank2}+.${nullIsh}+.${closeBracket}:last-child`\r\n      } else {\r\n        // FIXME: be more resilient to other cases\r\n        const closing5 = SliceClassList(line, -5)\r\n        if (!closing5.okLength) continue\r\n        // prettier-ignore\r\n        const [blank0, closeBrace,               colonBlank, nullIsh, closeBracket] = toFlatClassList(closing5)\r\n        selector = `.${blank0}+.${closeBrace}+.${colonBlank}+.${nullIsh}+.${closeBracket}:last-child`\r\n      }\r\n\r\n      flags.jsxTernaryOtherwise = {\r\n        // find \") : null}\" then hide it all\r\n        hide: `:has(${selector}) *`,\r\n        hover: selector,\r\n      }\r\n      // FIXME: find a better way to do this\r\n      customFlags.jsxTernaryOtherwiseHover = `.view-lines:has(.view-line span:hover ${selector}) {\r\n\t\t\t\t--r: red;\r\n\t\t\t}`\r\n\r\n      anyFlag = true\r\n    } else if (\r\n      !customFlags.singleQuotes &&\r\n      text.match(/(?<singleQuotes>\"\"|''|``)/)?.groups?.singleQuotes\r\n    ) {\r\n      const array = Array.from(line.children)\r\n      const quote = /\"|'|`/\r\n\r\n      singleQuotes: for (let i = 0; i < array.length; i++) {\r\n        const child = array[i]\r\n\r\n        const current = child.textContent?.match(quote)\r\n        const next = array[i + 1]?.textContent?.match(quote)\r\n        if (current?.[0].length == 1 && current[0] === next?.[0]) {\r\n          const beginQuote = Array.from(child.classList).join('.')\r\n          const endQuote = Array.from(array[i + 1].classList).join('.') // wow, why isn't typescript freaking out?\r\n\r\n          // Find \"\" or '' or `` and show them\r\n          customFlags.singleQuotes = `[class=\"${beginQuote}\"]:has(+.${endQuote}), [class=\"${beginQuote}\"]+.${endQuote} {\r\n\t\t\t\t\t\t\t--r: gray;\r\n\t\t\t\t\t\t}`\r\n          flags.beginQuote = {\r\n            // this is the most common case, you could derive it from other flags\r\n            hide: `>.${beginQuote}`,\r\n            hover: `.${beginQuote}`,\r\n          }\r\n          flags.endQuote = {\r\n            // this is the most common case, you could derive it from other flags\r\n            hide: `>.${endQuote}`,\r\n            hover: `.${endQuote}`,\r\n          }\r\n\r\n          anyFlag = true\r\n          break singleQuotes\r\n        }\r\n      }\r\n    }\r\n\r\n    if (anyFlag && isDone()) {\r\n      break parser\r\n    }\r\n  }\r\n\r\n  function isDone() {\r\n    // TODO: figure out how to pass empty flags\r\n    return (\r\n      Object.values(flags).every((f) => !!f) &&\r\n      Object.values(customFlags).every((f) => !!f)\r\n    )\r\n  }\r\n\r\n  return { flags, customFlags }\r\n}\r\n\r\ntype EditorFlags = (typeof editorFlags)[keyof typeof editorFlags]\r\nexport function assembleCss(editorFlags: EditorFlags) {\r\n  const root = `${linesSelector}>div>span`\r\n  const { flags, customFlags } = editorFlags\r\n\r\n  // you know the concise syntax hover feature will work because you found the common case\r\n  const validFlags = Object.values(flags).filter(\r\n    (f): f is Flag => !!(f?.hide && f.hover)\r\n  )\r\n  if (!validFlags.length || !flags.vsCodeHiddenTokens?.hover) {\r\n    console.warn('Fail to find common case')\r\n    return\r\n  }\r\n\r\n  const toHover = validFlags.map((f) => f.hover).join(',')\r\n  const toHidden = validFlags.map((f) => root + f.hide).join(',')\r\n  const toCustom = Object.values(customFlags)\r\n    .filter((f) => !!f)\r\n    .join('\\n')\r\n\r\n  return `\r\n\t\t.view-lines {\r\n\t\t\t--r: transparent;\r\n\t\t}\r\n\t\t.view-lines > div:hover {\r\n\t\t\t--r: yellow;\r\n\t\t}\r\n\t\t.view-lines:has(:is(${toHover}):hover) {\r\n\t\t\t--r: red;\r\n\t\t}\r\n\t\t${toHidden} {\r\n\t\t\tcolor: var(--r);\r\n\t\t}\r\n\t\t${toCustom}\r\n\t\t`\r\n}\r\n\r\ntype Flag = {\r\n  hide: string\r\n  hover: string\r\n}\r\ntype FlagOr = null | Flag\r\n\r\nfunction toFlatClassList<T extends { join: (to?: string) => string }>(\r\n  Array: T[]\r\n) {\r\n  return Array.reduce(\r\n    (acc, val) => acc.concat(val.join('.')),\r\n    <string[]>[]\r\n  ) as string[] // FIXME: avoid casting\r\n}\r\n\r\nfunction SliceClassList(line: Element, slice: number) {\r\n  const sliced = Array.from(line.children)\r\n    .slice(slice)\r\n    .map((c) => Array.from(c.classList))\r\n  return Object.assign(sliced, { okLength: sliced.length == slice * -1 })\r\n}\r\n\r\nexport function mergeDeep(...objects: any[]) {\r\n  const isObject = (obj: any) => obj && typeof obj === 'object'\r\n\r\n  return objects.reduce((prev, obj) => {\r\n    Object.keys(obj).forEach((key) => {\r\n      const pVal = prev[key]\r\n      const oVal = obj[key]\r\n\r\n      if (Array.isArray(pVal) && Array.isArray(oVal)) {\r\n        prev[key] = pVal.concat(...oVal)\r\n      } else if (isObject(pVal) && isObject(oVal)) {\r\n        prev[key] = mergeDeep(pVal, oVal)\r\n      } else {\r\n        prev[key] = oVal\r\n      }\r\n    })\r\n\r\n    return prev\r\n  }, {})\r\n}\r\n","/**\r\n * Less Call Stack\r\n */\r\nexport function createObservable<T>(initialValue: T) {\r\n  let _value: T = initialValue\r\n  type SelfCleanup = (() => void) | 'Symbol.dispose' // is this well supported?\r\n  type Subscriber = (payload: T) => SelfCleanup | void\r\n  let _subscribers: Subscriber[] = []\r\n  let _toDispose = new Map<Subscriber, SelfCleanup[]>()\r\n\r\n  function splice(sub: Subscriber) {\r\n    _subscribers = _subscribers.filter((fn) => fn !== sub)\r\n    _toDispose.get(sub)?.forEach((fn) => typeof fn === 'function' && fn())\r\n    _toDispose.delete(sub)\r\n  }\r\n  return {\r\n    get value(): T {\r\n      return _value\r\n    },\r\n    set value(payload: T) {\r\n      if (_value === payload) return\r\n      _value = payload\r\n      this.notify()\r\n    },\r\n    notify() {\r\n      // debugger right now it is hardcoded... maybe after each subscriber callback _toDispose should be cleaned up\r\n      for (let i = 0; i < _subscribers.length; i++) {\r\n        const sub = _subscribers[i]\r\n        const res = sub(_value)\r\n\r\n        if (typeof res === 'function') {\r\n          // prettier-ignore\r\n          _toDispose.set(sub, (_toDispose.get(sub) || []).concat(res))\r\n        } else if (res === 'Symbol.dispose') {\r\n          splice(sub)\r\n          i -= 1\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * Subscribe without calling the callback immediately\r\n     */\r\n    $ubscribe(sub: Subscriber) {\r\n      _subscribers.push(sub)\r\n      return () => splice(sub)\r\n    },\r\n  }\r\n}\r\nexport type Observable<T> = ReturnType<typeof createObservable<T>>\r\n","/** Just use the Either monad... */\r\nexport class or_return<T> {\r\n  constructor(\r\n    private fn: () => T | ((a: any) => T),\r\n    private onError: () => any\r\n  ) {\r\n    this.fn = fn\r\n    this.onError = onError\r\n  }\r\n\r\n  finally<R, Y = T>(fn: (a: NonNullable<Y>) => R): R | undefined {\r\n    try {\r\n      const value = this.fn()\r\n      if (value) {\r\n        // @ts-ignore\r\n        return fn(value)\r\n      } else {\r\n        this.onError()\r\n      }\r\n    } catch (error) {\r\n      this.onError()\r\n    }\r\n  }\r\n\r\n  or_return<Y>(fn: (a: NonNullable<T>) => Y, onError: () => any) {\r\n    try {\r\n      const value = this.fn()\r\n      if (value) {\r\n        // @ts-ignore\r\n        return new or_return(() => fn(value), onError)\r\n      } else {\r\n        this.onError()\r\n      }\r\n    } catch (error) {\r\n      this.onError()\r\n    }\r\n    return new or_return(console.log, console.error) as or_return<Y>\r\n  }\r\n}\r\n","import { createSyntaxLifecycle } from './syntax'\r\nimport { createHighlightLifeCycle } from './highlight'\r\nimport { extensionId, viewLinesSelector } from './keys'\r\nimport { IState, State, calibrationFileName, state } from 'src/shared/state'\r\nimport { ICalibrate, Calibrate, calibrate } from 'src/shared/state'\r\nimport { createStyles, toastConsole } from './shared'\r\n// prettier-ignore\r\nimport { assembleCss, editorFlags, jsx_parseStyles, mergeDeep } from './regexToDomToCss'\r\nimport { createObservable } from '../shared/observable'\r\nimport { or_return } from '../shared/or_return'\r\nimport { deltaFn } from 'src/shared/utils'\r\nimport { createTryFunction } from './lifecycle'\r\nexport type { editorObservable, stateObservable, calibrateObservable }\r\n\r\nconst editorObservable = createObservable<undefined | string>(undefined)\r\nconst stateObservable = createObservable<State | undefined>(undefined)\r\nconst calibrateObservable = createObservable<Calibrate | undefined>(undefined)\r\n\r\nconst sessionKey = `${extensionId}.sessionFlags.jsx`\r\nfunction TryRegexToDomToCss(lineEditor: HTMLElement) {\r\n  let jsxFlags = jsx_parseStyles(lineEditor, editorFlags.jsx)\r\n  try {\r\n    let session = JSON.parse(window.localStorage.getItem(sessionKey) || '{}')\r\n    if (typeof session !== 'object') {\r\n      session = {}\r\n    }\r\n    function checkMissingProps(obj: object) {\r\n      for (const [key, value] of Object.entries(obj)) {\r\n        if (typeof value === 'object') {\r\n          checkMissingProps(value)\r\n        } else if (!value) {\r\n          // prettier-ignore\r\n          toastConsole.error(`Missing flag property ${key} and possibly more...`, { obj,key,value })\r\n          return\r\n        }\r\n      }\r\n    }\r\n    checkMissingProps(jsxFlags)\r\n    jsxFlags = mergeDeep(session, jsxFlags)\r\n    // TODO: check if there are new flags or new schema then delete the session\r\n    window.localStorage.setItem(sessionKey, JSON.stringify(jsxFlags))\r\n  } catch (error: any) {\r\n    window.localStorage.removeItem(sessionKey)\r\n    toastConsole.error(`Failed to store jsx flags: ${error.message}`, { error })\r\n  }\r\n  return assembleCss(jsxFlags)\r\n}\r\nfunction cacheProc() {\r\n  try {\r\n    let session = JSON.parse(window.localStorage.getItem(sessionKey) || '{}')\r\n    if (typeof session !== 'object') {\r\n      throw new Error('session is not an object')\r\n    }\r\n    const cache = assembleCss(session)\r\n    if (cache) syntaxStyle.styleIt(cache)\r\n  } catch (error) {\r\n    window.localStorage.removeItem(sessionKey)\r\n  }\r\n}\r\nconst calibrateStyle = createStyles('calibrate')\r\ncalibrateStyle.styleIt(`${ICalibrate.selector}{display: none !important}`)\r\n\r\nconst createCalibrateSubscription = () =>\r\n  calibrateObservable.$ubscribe((value) => {\r\n    if (value != calibrate.opened) return\r\n    // prettier-ignore\r\n    new or_return(\r\n      () => document.querySelector<HTMLElement>(`[data-uri$=\"concise-syntax/out/${calibrationFileName}\"] ${viewLinesSelector}`),\r\n      () => toastConsole.error('Calibrate Editor not found')\r\n    )\r\n    .or_return(\r\n      TryRegexToDomToCss, \r\n      () => toastConsole.error('Failed to calibrate editor')\r\n    )\r\n    .finally(css => {\r\n      requestAnimationFrame(() => syntaxStyle.styleIt(css))\r\n\r\n      if (!highlight.running) {\r\n        highlight.activate(500) // FIXME: find the moment the css finishes loading\r\n      }\r\n    })\r\n  })\r\n\r\nconst createEditorSubscription = () =>\r\n  editorObservable.$ubscribe((value) => {\r\n    if (!value) return\r\n    cacheProc()\r\n    return 'Symbol.dispose'\r\n  })\r\n\r\nconst syntaxStyle = createStyles('hide')\r\n// Just use the \"using\" keyword...\r\nconst createStateSubscription = () =>\r\n  stateObservable.$ubscribe((deltaState) => {\r\n    if (deltaState == state.active) {\r\n      if (!calibration.running) {\r\n        calibration.activate(500)\r\n        let unSubscribers = [createCalibrateSubscription()]\r\n\r\n        cacheProc()\r\n        if (!highlight.running) {\r\n          highlight.activate(500) // FIXME: find the moment the css finishes loading\r\n          unSubscribers.push(createEditorSubscription())\r\n        }\r\n\r\n        return () => unSubscribers.forEach((un) => un())\r\n      }\r\n    } else {\r\n      syntaxStyle.dispose()\r\n      highlight.dispose() // the unwinding of the editorObservable could cause a stack overflow\r\n      calibration.dispose()\r\n    }\r\n  })\r\n\r\nconst syntax = createSyntaxLifecycle(stateObservable, IState)\r\nconst calibration = createSyntaxLifecycle(calibrateObservable, ICalibrate)\r\nconst highlight = createHighlightLifeCycle(editorObservable)\r\n\r\nconst deltaDispose = deltaFn()\r\nconst tryFn = createTryFunction()\r\nconst conciseSyntax = {\r\n  activate() {\r\n    tryFn(() => {\r\n      deltaDispose.consume()\r\n      syntax.activate()\r\n      const unSubscribeState = createStateSubscription()\r\n      deltaDispose.fn = () => {\r\n        tryFn(() => {\r\n          syntax.dispose()\r\n          stateObservable.value = state.inactive\r\n          unSubscribeState()\r\n        }, 'Failed to dispose concise-syntax')\r\n      }\r\n    }, 'Failed to activate concise-syntax')\r\n  },\r\n  dispose: deltaDispose.consume,\r\n}\r\n\r\n// prettier-ignore\r\ndeclare global { interface Window { conciseSyntax?: typeof conciseSyntax } }\r\nif (window.conciseSyntax) {\r\n  window.conciseSyntax.dispose()\r\n}\r\nwindow.conciseSyntax = conciseSyntax\r\nconciseSyntax.activate()\r\n\r\nconsole.log(extensionId, conciseSyntax)\r\n\r\n/**\r\n * FIXME\r\n * handle drastic user changes for example when changing vscode's profile\r\n */\r\n"],"names":["tryFn","state","styles","top","watchForRemoval","elements","editorFlags","Array"],"mappings":"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"}